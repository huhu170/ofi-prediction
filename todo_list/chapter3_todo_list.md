# 第三章 TODO清单

> 📅 创建时间：2026-01-13
> 📊 统计：共 **23** 项（图片 2 | 表格 12 | 公式 9）

---

## 📋 TODO列表

### 第一节 数据获取与预处理（6项）

| 序号 | 编号 | 类型 | 内容 | 所在小节 | 状态 |
|-----|------|-----|------|---------|------|
| 1 | 表 3.1-1 | 表格 | 本研究数据与学术基准数据库的对比 | 一、数据来源 | ⬜ 待完成 |
| 2 | 公式 (3.1-1) | 公式 | 时间窗口内OFI的聚合定义 | 二、数据清洗与特征描述采样 | ✅ 已完成 |
| 3 | 公式 (3.1-2) | 公式 | 零均值标准化公式 | 二、数据清洗与特征描述采样 | ✅ 已完成 |
| 4 | 图 3.1-1 | 图片 | 滑动窗口采样示意图 | 二、数据清洗与特征描述采样 | ⬜ 待完成 |
| 5 | 公式 (3.1-3) | 公式 | 三分类标签定义 | 二、数据清洗与特征描述采样 | ✅ 已完成 |
| 6 | 公式 (3.1-4) | 公式 | 交易方向识别规则 | 三、数据对齐方法 | ✅ 已完成 |

### 第二节 指数与代表性个股的动态协方差分析（7项）

| 序号 | 编号 | 类型 | 内容 | 所在小节 | 状态 |
|-----|------|-----|------|---------|------|
| 7 | 公式 (3.2-1) | 公式 | 滚动窗口协方差估计 | 一、方法概述 | ✅ 已完成 |
| 8 | 公式 (3.2-2) | 公式 | 中间价收益率定义 | 二、数据选择与预处理 | ✅ 已完成 |
| 9 | 公式 (3.2-3) | 公式 | 滚动窗口协方差估计公式 | 三、协方差计算与个股筛选 | ✅ 已完成 |
| 10 | 公式 (3.2-4) | 公式 | 滚动相关系数计算 | 三、协方差计算与个股筛选 | ✅ 已完成 |
| 11 | 表 3.2-1 | 表格 | 个股筛选标准与结果汇总 | 三、协方差计算与个股筛选 | ⬜ 待完成 |
| 12 | 表 3.2-2 | 表格 | 低相关性对照组筛选标准 | 三、协方差计算与个股筛选 | ⬜ 待完成 |
| 13 | 表 3.2-3 | 表格 | 动态协方差方法与其他跨资产建模方法的对比 | 四、动态协方差与其他方法的对比 | ⬜ 待完成 |

### 第三节 特征工程配置（4项）

| 序号 | 编号 | 类型 | 内容 | 所在小节 | 状态 |
|-----|------|-----|------|---------|------|
| 14 | 表 3.3-1 | 表格 | OFI特征配置汇总 | 一、OFI系列特征：配置参数汇总 | ⬜ 待完成 |
| 15 | 表 3.3-2 | 表格 | 动态形态特征配置 | 二、动态形态特征（本研究新增） | ⬜ 待完成 |
| 16 | 表 3.3-3 | 表格 | 标签阈值配置 | 三、特征归一化与标签配置 | ⬜ 待完成 |
| 17 | 表 3.3-4 | 表格 | 特征输入汇总 | 四、特征汇总与输入维度 | ⬜ 待完成 |

### 第四节 模型训练配置与评估框架（6项）

| 序号 | 编号 | 类型 | 内容 | 所在小节 | 状态 |
|-----|------|-----|------|---------|------|
| 18 | 表 3.4-1 | 表格 | 基准模型超参数配置 | 一、基准模型配置 | ⬜ 待完成 |
| 19 | 表 3.4-2 | 表格 | 深度学习模型架构配置 | 二、深度学习模型配置 | ⬜ 待完成 |
| 20 | 图 3.4-1 | 图片 | 本研究模型架构示意图 | 二、深度学习模型配置 | ⬜ 待完成 |
| 21 | 表 3.4-3 | 表格 | 滚动训练窗口配置 | 三、训练策略 | ⬜ 待完成 |
| 22 | 公式 (3.4-1) | 公式 | 协方差加权损失函数 | 三、训练策略 | ✅ 已完成 |
| 23 | 表 3.4-4 | 表格 | 评估指标体系 | 四、评估指标体系 | ⬜ 待完成 |

---

## 📝 详细说明

### 表 3.1-1：本研究数据与学术基准数据库的对比

**位置**：`目录大纲.md` 第598行

**内容要求**：
- **来源**：作者整理
- **表格结构**：对比维度（数据源、时间范围、资产覆盖、数据频率、字段类型）

---

### 公式 (3.1-1)：时间窗口内OFI的聚合定义

**位置**：`目录大纲.md` 第621行

**内容要求**：
- **来源**：参考 Cont et al. (2014) Section 2.1 OFI definition
- **符号约定**：
  - $OFI_k = \sum_{n=N(t_{k-1})+1}^{N(t_k)} e_n$
  - $e_n$ = 第n个事件的贡献值（买方为正，卖方为负）
  - $N(t)$ = 时刻t之前的累计事件数
  - $\Delta t = t_k - t_{k-1} = 10s$（本研究设定）

**LaTeX公式**：
```latex
OFI_k = \sum_{n=N(t_{k-1})+1}^{N(t_k)} e_n
```

---

### 公式 (3.1-2)：零均值标准化公式

**位置**：`目录大纲.md` 第638行

**内容要求**：
- **来源**：标准机器学习预处理方法，参考 Crossformer (Zhang and Yan, 2023) Protocols
- **符号约定**：
  - $\tilde{x}_{i,t} = \frac{x_{i,t} - \mu_i}{\sigma_i}$
  - $x_{i,t}$ = 第i个特征在时刻t的原始值
  - $\mu_i, \sigma_i$ = 第i个特征在**训练集**上的均值与标准差
- **关键约束**：验证集与测试集使用训练集的参数进行变换，严禁使用未来信息

**LaTeX公式**：
```latex
\tilde{x}_{i,t} = \frac{x_{i,t} - \mu_i}{\sigma_i}
```

---

### 图 3.1-1：滑动窗口采样示意图

**位置**：`目录大纲.md` 第652行

**内容要求**：
- **来源**：作者自制
- **内容描述**：
  - 输入窗口：过去T个时间步的LOB快照与OFI特征序列（T=100）
  - 预测目标：未来第k个时间步的中间价变化方向或收益率
  - 滑动步长：stride=1

**建议工具**：Draw.io / Visio / PowerPoint

---

### 公式 (3.1-3)：三分类标签定义

**位置**：`目录大纲.md` 第676行

**内容要求**：
- **来源**：参考 Zhang et al. (2019) Section 3C - Data Normalisation and Labelling
- **符号约定**：
  - 令 $m_t = (p_a^{(1)}(t) + p_b^{(1)}(t))/2$ 为时刻t的中间价
  - 令 $r_{t,k} = (m_{t+k} - m_t)/m_t$ 为未来k步的收益率
  - 标签定义：
    - $y_t = +1$ if $r_{t,k} > \alpha$（上涨）
    - $y_t = -1$ if $r_{t,k} < -\alpha$（下跌）
    - $y_t = 0$ otherwise（平稳）
  - $\alpha$ = 涨跌阈值（通常取0.001或0.002）

**LaTeX公式**：
```latex
y_t = \begin{cases} +1 & \text{if } r_{t,k} > \alpha \\ -1 & \text{if } r_{t,k} < -\alpha \\ 0 & \text{otherwise} \end{cases}
```

---

### 公式 (3.1-4)：交易方向识别规则

**位置**：`目录大纲.md` 第739行

**内容要求**：
- **来源**：参考 Lee and Ready (1991)，Cushing and Madhavan (2000) 实证设置
- **符号约定**：
  - **报价规则**：若成交价 $P_t > M_t$（中间价），判定为买方发起；若 $P_t < M_t$，判定为卖方发起
  - **Tick规则**：若 $P_t = M_t$，则比较与前一笔成交价：$P_t > P_{t-1}$ 为买方发起，$P_t < P_{t-1}$ 为卖方发起
  - **中间价定义**：$M_t = (P_a^{(1)}(t) + P_b^{(1)}(t))/2$

---

### 公式 (3.2-1)：滚动窗口协方差估计

**位置**：`目录大纲.md` 第793行

**内容要求**：
- **来源**：标准金融计量方法
- **符号约定**：
  - $\hat{\sigma}_{i,m,t} = \frac{1}{W-1} \sum_{s=t-W+1}^{t} (r_{i,s} - \bar{r}_i)(r_{m,s} - \bar{r}_m)$
  - $W$ = 滚动窗口长度（本研究设为100个时间步，对应约16.7分钟）
  - $\bar{r}_i, \bar{r}_m$ = 窗口内收益率均值
- **归一化**：进一步计算滚动相关系数

**LaTeX公式**：
```latex
\hat{\sigma}_{i,m,t} = \frac{1}{W-1} \sum_{s=t-W+1}^{t} (r_{i,s} - \bar{r}_i)(r_{m,s} - \bar{r}_m)
```

---

### 公式 (3.2-2)：中间价收益率定义

**位置**：`目录大纲.md` 第833行

**内容要求**：
- **来源**：参考 Zhang et al. (2019) Section 3C，Cont et al. (2023) Section 2
- **符号约定**：
  - 中间价：$m_t = (p_a^{(1)}(t) + p_b^{(1)}(t))/2$
  - 对数收益率：$r_t = \ln(m_t) - \ln(m_{t-1})$
  - 或百分比收益率：$r_t = (m_t - m_{t-1})/m_{t-1}$

**LaTeX公式**：
```latex
r_t = \ln(m_t) - \ln(m_{t-1})
```

---

### 公式 (3.2-3)：滚动窗口协方差估计公式

**位置**：`目录大纲.md` 第874行

**内容要求**：
- **来源**：标准金融计量方法
- **符号约定**：
  - $\hat{\sigma}_{i,m,t} = \frac{1}{W-1} \sum_{s=t-W+1}^{t} (r_{i,s} - \bar{r}_{i,t})(r_{m,s} - \bar{r}_{m,t})$
  - $\bar{r}_{i,t} = \frac{1}{W} \sum_{s=t-W+1}^{t} r_{i,s}$
  - $W$ = 滚动窗口长度（以时间步数计）
- **说明**：使用W-1作为分母（样本协方差），以获得无偏估计

---

### 公式 (3.2-4)：滚动相关系数计算

**位置**：`目录大纲.md` 第884行

**内容要求**：
- **来源**：标准统计方法
- **符号约定**：
  - $\hat{\rho}_{i,m,t} = \frac{\hat{\sigma}_{i,m,t}}{\hat{\sigma}_{i,t} \cdot \hat{\sigma}_{m,t}}$
  - $\hat{\sigma}_{i,t}$、$\hat{\sigma}_{m,t}$ = 个股与指数在窗口内的滚动标准差
  - $\hat{\rho}_{i,m,t} \in [-1, 1]$

**LaTeX公式**：
```latex
\hat{\rho}_{i,m,t} = \frac{\hat{\sigma}_{i,m,t}}{\hat{\sigma}_{i,t} \cdot \hat{\sigma}_{m,t}}
```

---

### 表 3.2-1：个股筛选标准与结果汇总

**位置**：`目录大纲.md` 第934行

**内容要求**：
- **来源**：作者整理
- **表格结构**：筛选维度、筛选标准、通过数量

---

### 表 3.2-2：低相关性对照组筛选标准

**位置**：`目录大纲.md` 第958行

**内容要求**：
- **来源**：作者整理
- **表格结构**：筛选维度、对照组标准、预期通过数

---

### 表 3.2-3：动态协方差方法与其他跨资产建模方法的对比

**位置**：`目录大纲.md` 第975行

**内容要求**：
- **来源**：作者整理
- **对比方法**：LASSO、VAR、DCC-GARCH、本研究方法

---

### 表 3.3-1：OFI特征配置汇总

**位置**：`目录大纲.md` 第1034行

**内容要求**：
- **来源**：作者整理
- **表格结构**：特征代号、定义依据、LOB深度K、衰减参数、撤单率阈值CR、说明

---

### 表 3.3-2：动态形态特征配置

**位置**：`目录大纲.md` 第1053行

**内容要求**：
- **来源**：作者整理
- **表格结构**：特征名称、计算方法、时间窗口/参数、经济含义

---

### 表 3.3-3：标签阈值配置

**位置**：`目录大纲.md` 第1069行

**内容要求**：
- **来源**：作者整理
- **表格结构**：资产类型、分类阈值α、预测步长k、说明

---

### 表 3.3-4：特征输入汇总

**位置**：`目录大纲.md` 第1082行

**内容要求**：
- **来源**：作者整理
- **表格结构**：特征类别、特征数量、说明

---

### 表 3.4-1：基准模型超参数配置

**位置**：`目录大纲.md` 第1098行

**内容要求**：
- **来源**：作者整理
- **表格结构**：模型、关键超参数、取值/优化方法、输入特征

---

### 表 3.4-2：深度学习模型架构配置

**位置**：`目录大纲.md` 第1110行

**内容要求**：
- **来源**：作者整理
- **表格结构**：模型、层数/结构、隐藏维度、Attention Heads、Dropout、激活函数

---

### 图 3.4-1：本研究模型架构示意图

**位置**：`目录大纲.md` 第1119行

**内容要求**：
- **来源**：自制
- **内容描述**：Smart-Trans模型架构（4层Encoder+协方差注入）

**建议工具**：Draw.io / Visio / PowerPoint

---

### 表 3.4-3：滚动训练窗口配置

**位置**：`目录大纲.md` 第1133行

**内容要求**：
- **来源**：作者整理
- **表格结构**：参数、取值、说明

---

### 公式 (3.4-1)：协方差加权损失函数

**位置**：`目录大纲.md` 第1144行

**内容要求**：
- **来源**：本研究创新
- **符号约定**：
  - $\mathcal{L}_{weighted} = \sum_t w_t \cdot \ell(y_t, \hat{y}_t)$
  - $w_t = 1 + \gamma \cdot \max(0, \rho_{i,m,t})$
  - $\gamma$ = 权重调节系数（网格搜索$\gamma \in \{0.5, 1.0, 2.0\}$）
- **设计说明**：
  - 仅对正相关加权：使用$\max(0, \rho)$而非$|\rho|$
  - 权重范围：当$\rho \in [0, 1]$时，$w_t \in [1, 1+\gamma]$

**LaTeX公式**：
```latex
\mathcal{L}_{weighted} = \sum_t w_t \cdot \ell(y_t, \hat{y}_t), \quad w_t = 1 + \gamma \cdot \max(0, \rho_{i,m,t})
```

---

### 表 3.4-4：评估指标体系

**位置**：`目录大纲.md` 第1170行

**内容要求**：
- **来源**：作者整理
- **表格结构**：维度、指标、计算方法、评估目标

---

## 📊 完成进度

```
第三章 TODO 完成度：9/23 (39%)
████████░░░░░░░░░░░░ 39%
```

---

## 📊 分类统计

| 类型 | 数量 | 已完成 | 待完成 |
|-----|-----|--------|--------|
| 公式 | 9 | ✅ 9 | 0 |
| 表格 | 12 | 0 | ⬜ 12 |
| 图片 | 2 | 0 | ⬜ 2 |
| **合计** | **23** | **9** | **14** |

---

## ✏️ 更新日志

| 日期 | 操作 | 备注 |
|-----|------|-----|
| 2026-01-13 | 创建清单 | 初始化第三章TODO列表 |
| 2026-01-16 | 完成全部公式 | 9个公式已填入目录大纲.md，包括(3.1-1)至(3.4-1) |