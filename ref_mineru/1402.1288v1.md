# Market impact as anticipation of the order flow imbalance

Thibault Jaisson∗ CMAP, Ecole Polytechnique Paris ´ thibault.jaisson@polytechnique.edu

February 7, 2014

# Abstract

In this paper, we assume that the permanent market impact of metaorders is linear and that the price is a martingale. Those two hypotheses enable us to derive the evolution of the price from the dynamics of the flow of market orders. For example, if the market order flow is assumed to follow a nearly unstable Hawkes process, we retrieve the apparent long memory of the flow together with a power law impact function which is consistent with the celebrated square root law. We also link the long memory exponent of the sign of market orders with the impact function exponent. One of the originalities of our approach is that our results are derived without assuming that market participants are able to detect the beginning of metaorders.

Keywords: Market impact, metaorder, market order flow, Hawkes processes, long memory, square root law, market efficiency.

# 1 Introduction

Loosely speaking, the market impact is the link between the volume of an order (either market order or metaorder1) and the price moves during and after the execution of this order, see [9]. Accurate modelling of market impact is of paramount importance. Practically, market impact greatly affects brokers, market makers but also large investors in the design of their optimal strategies. For example, market impact tends to decrease the profits of investment strategies by creating an execution cost that increases with the volume of the transaction. From a theoretical point of view, it is argued in [10] and [36] that endogenous (that is independent of information outside of the market) changes in supply and demand have more influence on price fluctuations than exogenous information. Therefore, understanding the price formation process necessarily goes through understanding market impact.

Here we focus on metaorders. More precisely, we study the impact function of metaorders, which is the expectation of the price move with respect to time during and after the execution of the metaorder. We call permanent market impact of a metaorder the limit in time of the impact function (that is the average price move between the start of the metaorder and a long time after its execution). The literature on this topic is often rooted to the seminal work of Kyle [29]. In the latter, it is shown that an informed trader who has private information on the future of the price should incrementally execute his metaorder, thereby slowly revealing the price to the rest of the market. However, it is also deduced that the market impact should be linear throughout the execution of the metaorder, which does not agree with empirical studies that consistently give a strictly concave market impact. We refer for example to [8] and [34] where the estimated impact function is close to a power law with respect to time throughout the execution, with exponent being between 0.5, see [8], and 0.7, see [34]. These empirical results are often referred to as the square root law.

The first main theoretical explanations of the concavity of the impact function connect it to the behaviour of large investors, see [18], the persistence in the order flow, see [11] and [31], or the size distribution of metaorders, see [16]. In [37], Toth et al. show that the diffusivity of the price can be linked to the V-shape of the latent order book. They propose a model in which they numerically show that the concavity of the impact function depends on the long memory of the order flow. Recently, Farmer et al. [16] have managed to relate this concavity to the distribution of the sizes of metaorders. More precisely, in their model, they get a power law impact function whose exponent $\nu$ is linked to the exponent of the distribution tail of the size of metaorders $\beta$ by $\nu = \beta - 1$ , which quite fits empirical data. To obtain this, they use two conditions: A martingale hypothesis on the price, and a fair pricing condition, which is derived from a Nash equilibrium between investors and states that the average ex post gain of a metaorder of any size should be zero. Let us remark that in [14], similar conditions are obtained using only perfect competition between market makers.

In the works mentioned above, it is assumed that market makers can precisely detect when a metaorder is being executed. Although reasonable for large metaorders, it is a strong postulate, especially at the beginning of the execution and for small metaorders. Here, we try to build a theory which does not require such an assumption. Indeed, market makers only see a flow of market orders and should thus set their prices according to this flow, and not to the underlying flow of metaorders.

It is well known, see [31], that the sign (buy or sell) of market orders presents persistence (more precisely, the correlation function of the sign process behaves as a power law with exponent lower than one). This persistence can be explained by the fact that the market order flow reflects the partition of metaorders into sequences of same-sided market orders. Indeed, it is shown in [32] that an order flow obtained from the fragmentation of metaorders exhibits long memory. In [38], it is empirically proved that the persistence in the sign process mostly comes from splitting (and not herding).

In [11], Bouchaud et al. propose a way to obtain a diffusive price process from a long memory order flow modelled as a discrete time FARIMA process (see [7] for definition). To do so, they consider that the impact of a market order decreases in time as a power law (where the exponent of the power law is linked to the exponent of the long memory). However, in this work, the impact is not related to the notion of metaorder. In particular, if one executes a metaorder in this model, its permanent impact is null, see [10]. Moreover, while the permanent impact of metaorders is not easy to compute, it does not seem to be zero in practice, see [34]. Our aim is to somehow place ourselves between [11] and [16]. We assume that the permanent impact of metaorders does exist with a specific (linear) form derived from no price manipulation arguments. Furthermore, we consider that market makers only see the flow of market orders that they essentially understand as a superposition of fragmented metaorders.

There are two manners to understand why metaorders impact the price. In most papers, see for example [16] and [29], market impact is viewed as a way to pass on private information to the price. In these models, large investors react to information signals on the future expectation of the price using metaorders. In such approaches, metaorders reveal “fundamental” price moves but do not really cause them. In particular, if a metaorder is executed for no reason, it does not have any long term impact on the price. Here, we use the other vision of market impact. We assume that it is mechanical in the sense that a metaorder moves the price through its volume, by creating a long term imbalance in supply and demand, independently of the informativeness of the metaorder2. Choosing between these two paradigms requires brokerage data where the client accepts to say whether he is trading because he has directional views on the price or for another reason (risk management, hedging, regulatory constraints,...). This is done in [39] where it is shown that after a few days, the impact of “informed trades” is larger than that of “cash flow trades” (which even tends to be null). However, at intraday time scales, which are of interest here, the two previous impact functions are very close.

In some papers, see for example [19] and [26], the mechanical vision of market impact is implicitly assumed to derive important results. In these two articles, the authors derive conditions in their models so that a round $\mathrm { t r i p }$ is not profitable on average. In [26], it is applied to the Almgren-Chriss optimal liquidation framework, see [2], and the authors obtain that the permanent impact of a trade must be linear in its size. In [19], this hypothesis is considered in a more general model and once again, it is obtained that if there is permanent impact, it has to be linear. However, these reasonings only hold if the impact of a trade does not depend on the reason investors are executing their trades, therefore, under the hypothesis that the impact is mechanical.

In this work, we make two natural hypotheses: The linearity of the permanent market impact of a metaorder (which arises when impact is mechanical and there is no price manipulation but can also hold if impact is informational, see Section 2), and a martingale assumption on the price. These two hypotheses give us a simple and general relationship between the dynamics of the order flow and the evolution of the price (Equation (1)). Let us emphasize that this relationship is not between the price and the flow of specific metaorders which are not observable by market makers. We then apply this formula to the example of an order flow modelled by a nearly unstable Hawkes process.

Hawkes processes, introduced in [23], have been successfully applied to seismology, neurophysiology, epidemiology, and reliability and are nowadays very popular in finance. Among their recent applications in this field, let us cite the studies of tick by tick prices in [5], trades in [12], order books in [30], financial contagion in [1] and credit risk in [15]. Using Hawkes processes to model the flow of market orders in continuous time is natural. Indeed, it is a simple way to introduce clustering in the order flow and to reproduce the empirical correlation functions of buy and sell orders, see [3].

We will see that we recover many well known stylized facts of market impact under the Hawkes assumption. In particular, at the scale of individual market orders, we will compute a continuous time propagator model which generalizes the discrete time propagator proposed in [11]. In such models, the impact of a market order on the price does not depend on the past of the market order flow but is decreasing in time. At the scale of metaorders, we will compute a power law impact function, where the exponent of the power law $\nu$ is linked to the exponent of the long memory of the order flow $\gamma$ by the relation: $\gamma = 2 \nu - 1$ . We thus somehow recover the square root law.

The paper is organized as follows. In Section 2, we explain and justify the use of the linear permanent impact assumption and we compute our general impact equation. In Section 3, we apply this equation to the example of an order flow modelled by nearly unstable Hawkes processes. We derive the price process implied by such an order flow and show that the impact function of a metaorder is asymptotically a power law with exponent lower than one. We conclude in Section 4.

# 2 Computing price moves from the order flow

The aim of this section is to present our assumptions and to see how they imply our impact equation that links the dynamics of the price to that of the order flow.

# 2.1 Linear permanent impact under the mechanical impact assumption

In this section, we explain why it is reasonable to assume that the permanent market impact ( $P M I$ for short) of a metaorder is linear in its volume under the mechanical vision of market impact.

During and after the execution of a metaorder of volume $V$ , the price process is impacted. Indeed, if one buys a large quantity of stock, the price moves upward on average. We assume that a long time after the execution of the metaorder (compared to the time it takes to execute it), the market somehow returns to some kind of stationary state except that the price has on average moved by a value that only depends on $V$ . The permanent market impact, is by definition this average price move between the start of the execution of the order and a long time after the end of this execution:

$$
P M I ( V ) = \operatorname* { l i m } _ { s \to + \infty } \mathbb { E } [ P _ { s } - P _ { 0 } | V ] ,
$$

where $s = 0$ corresponds to the beginning of the metaorder and $P _ { s }$ is the mid price process. We assume that the impact of metaorders is large enough so that we can neglect the spread and thus the mid, ask and bid prices are close.

In order to measure this impact, one thus has to wait for the market to absorb the volume of the order and to get to its new equilibrium.

Remark 2.1. The notion of expectation is in fact not defined outside of a model. Here, we make the assumption (that is implicit in most works on market impact) that the dynamics of the market satisfy stationarity conditions which allow us to compute expectations as empirical averages.

Remark 2.2. The need to wait a long time (metaorders can last days), the variations of the market state (market impact depends on the stock, volatility, market activity,...) as well as the relative small number of recorded metaorders (in [34], they detect around 100 000 metaorders per year on 74 stocks traded on the LSE, in [8] they use 12 500 metaorders) make it very difficult to have robust empirical laws on the permanent impact. For example, in [8], the empirical permanent impact of a metaorder with respect to its duration is derived by averaging over metaorders on many stocks and market states (time periods) which might seem arguable. We can however say that the permanent market impact seems different from zero.

We place ourselves in the mechanical impact paradigm explained in the introduction and give two simple possible reasons why this impact should be linear in the volume of the metaorder:

$$
P M I ( V ) = k V .
$$

The first one is functional. Indeed, if this impact does not depend on the way the investor executes his order, then the two following executions should lead to the same permanent impact:

i) Executing a volume $V$ .   
ii) Executing a volume $\rho V$ , waiting a long time (for the market to return to its stationary state) and executing $( 1 - \rho ) V$ $\rho \in [ 0 , 1 ]$ ).   
Therefore,

$$
P M I ( V ) = P M I ( \rho V ) + P M I ( ( 1 - \rho ) V ) ,
$$

which implies that $P M I$ must be linear.

Remark 2.3. This reasoning does not apply to the temporary (during the execution) part of the impact function which may depend on the way the metaorder is executed. Indeed, in ii), one has to wait a long time after the first part of the order has been executed otherwise the market would not be in its stationary state for the second part.

The second reason is based on “no price manipulation” arguments. In [26], it is shown that in the framework of Almgren and Chriss [2], where the impact is decomposed into execution costs and permanent market impact, the absence of price manipulations implies that the permanent market impact must be linear.

In [19], these arguments are generalized to a more realistic time dependent impact model. The model states that if a trader executes an order at a trading rate $\dot { x } _ { s }$ at time $s$ (assuming that the volume $x _ { t }$ executed up to time $t$ is differentiable), then he impacts the price $S$ in $t$ by: $\begin{array} { r } { \int _ { 0 } ^ { t } f ( \dot { x } _ { s } ) G ( t - s ) d s } \end{array}$ . Therefore, if without the trader, the price is a Brownian motion with volatility $\sigma$ , the price satisfies:

$$
S _ { t } = S _ { 0 } + \int _ { 0 } ^ { t } f ( \dot { x } _ { s } ) G ( t - s ) d s + \int _ { 0 } ^ { t } \sigma d B _ { s } ,
$$

where $f$ is the impact function and $G$ is the decay kernel, which represents the decrease of the impact of a trade through time.

In this model, using the same kind of arguments as in [19], we can easily show that if there is permanent impact, then this impact is linear in volume. More precisely, we have the following proposition:

Proposition 2.1. If there is no price manipulation in the sense of [19]4 and there is permanent impact, that is $G ( s ) \mathop { \to } _ { s \to + \infty } G _ { \infty } > 0$ , then $f$ is linear.

The proof is given in appendix.

Remark 2.4. In the previous model, the cumulated executed volume of the trader $\begin{array} { r } { x _ { t } = \int _ { 0 } ^ { t } \dot { x } _ { s } } \end{array}$ ds is assumed to be differentiable which is not the case in practice. Indeed, the volume is executed by individual market orders. However, if $f ( v ) = k v$ as above, the model can be rewritten:

$$
S _ { t } = S _ { 0 } + k \int _ { 0 } ^ { t } G ( t - s ) d x _ { s } + \int _ { 0 } ^ { t } \sigma d B _ { s } ,
$$

and generalised to real order flows. The permanent impact of a metaorder of volume $V$ is thus linear in its volume:

$$
P M I ( V ) = G _ { \infty } k V .
$$

Therefore, in a rather general model, the permanent impact of a metaorder has to be linear. However, let us point out that the preceding arguments assume that even traders who execute metaorders without information have a permanent impact on the price. Therefore, the impact has to be mechanical as explained in the introduction. This could seem unrealistic but in fact can be understood in terms of the aversion that asset managers have to holding large positions of an asset. In the next paragraph, we present a simple investor model which explains how even uninformed metaorders can impact an indifference price.

# 2.2 A toy investor model

A classical view is to consider that investors who use metaorders have a better information about the future of the price than other market participants, see for example [29]. However, this is based on the economical concept of an “informational price” whereas empirical studies seem to show that the main drive of price fluctuations is not information, see [36], but volume, see [10]. Indeed, in [36], Shiller argues that: “The movements in stock price indexes could not realistically be attributed to any objective new information, since movements in the indexes are “too big” relative to actual subsequent-movements in dividends”.

In this section, we consider a simple example of investor model, which is in fact a particular case of the CAPM model (see for example [35]). This model enables us to illustrate how an uninformed metaorder can have a long term mechanical impact on the price. This impact is due to the risk aversion of asset managers (that is their unwillingness to hold large positions of one asset) and not to information asymmetry.

We assume that there are $n$ investors in our market. There is a fixed number $N$ of shares that are spread between the agents and let us call $P$ the price. Every investor $( I _ { i } ) _ { i = 1 \ldots n }$ estimates that the distribution of the yield of a share has an average $E _ { i }$ and a variance $\Sigma _ { i }$ and chooses the number of shares $N _ { i }$ in his portfolio optimizing a mean variance criterion with risk aversion $\lambda _ { i }$ :

$$
\begin{array} { l l l } { { N _ { i } } } & { { = } } & { { \mathrm { a r g m a x } _ { x } \{ x ( E _ { i } - P ) - \lambda _ { i } x ^ { 2 } \Sigma _ { i } \} } } \\ { { } } & { { = } } & { { \displaystyle \frac { E _ { i } - P } { 2 \lambda _ { i } \Sigma _ { i } } . } } \end{array}
$$

Moreover,

$$
\sum _ { i = 1 } ^ { n } N _ { i } = N ,
$$

which gives the indifference price $P$ of investors:

$$
P = \frac { \displaystyle \sum _ { i = 1 } ^ { n } \frac { E _ { i } } { 2 \lambda _ { i } \Sigma _ { i } } - N } { \displaystyle \sum _ { i = 1 } ^ { n } \frac { 1 } { 2 \lambda _ { i } \Sigma _ { i } } } .
$$

Let us now assume that the total number of shares becomes $N - N _ { 0 }$ due to the action of some non optimizing agent needing to buy some shares (for cash flow reasons for example). The new indifference price is

$$
P ^ { + } = P + \frac { N _ { 0 } } { \displaystyle \sum _ { i = 1 } ^ { n } \frac { 1 } { 2 \lambda _ { i } \Sigma _ { i } } } = P + k N _ { 0 } .
$$

This means that in this framework, a metaorder has an impact on the indifference price that is linear in its size. We thus have illustrated (in a quite naive way admittedly!) how the impact of a trade might not depend on its informativeness.

Remark 2.5. Let us stress again that in contrast to [16] and [29], in our framework, the impact of an order is purely due to its volume and not to any exogenous information. Therefore, all traders are equivalent and there are no noise traders. In particular, individual trades should be considered as small metaorders.

# 2.3 Impact dynamics

We have shown that it is reasonable to consider that every metaorder executed by a market participant has a long term impact on the price that is linear in its size. Here, we moreover assume a martingale property for the price. We use these assumptions to get a general impact equation linking the order flow dynamics and the price process.

Let us denote by $\vert 0 , S \vert$ the time during which metaorders are being executed (which can be thought of as the trading day) and by $V _ { t } ^ { a }$ and $V _ { t } ^ { b }$ the cumulated volumes of market orders at the ask and at the bid up to a time $t \in [ 0 , S ]$ . We consider the following assumption.

Assumption 1. Metaorders are executed only via market orders and market orders are only used to execute metaorders. Therefore, the daily cumulated volume of buy (resp. sell) market orders $V _ { S } ^ { a }$ (resp. $V _ { S } ^ { b }$ ) is equal to the sum of the volume of the $N _ { S } ^ { a }$ buy (resp. $N _ { S } ^ { b }$ sell) metaorders of the day

$$
V _ { S } ^ { a } = \sum _ { i = 1 } ^ { N _ { S } ^ { a } } v _ { i } ^ { a } ,
$$

where $v _ { i } ^ { a }$ is the volume of the $i ^ { t h }$ buy metaorder of the day.

Remark 2.6. Assumption 1 is used for simplicity and can in fact be weakened to Assumption 1 of [28] that states that the daily cumulated volume of buy (resp. sell) market orders is proportional (and not necessarily equal) to the sum of the volume of the $N _ { S } ^ { a }$ buy (resp. $N _ { S } ^ { b }$ sell) metaorders of the day:

$$
V _ { S } ^ { a } = \frac { \chi } { 2 } \sum _ { i = 1 } ^ { N _ { S } ^ { a } } v _ { i } ^ { a } ,
$$

where $\chi$ can be understood as “the level of intermediation in the market”. Hereinafter, we will take $\chi = 2$ .

To fix ideas, we assume that at the beginning and at the end of the day, there are auctions whose prices are denoted by $P _ { 0 } ^ { - }$ and $P _ { S } ^ { + }$ . Then our assumption on the linearity of the permanent market impact goes as follows.

Assumption 2. $P _ { S } ^ { + }$ is on average equal to the price of the opening auction $P _ { 0 } ^ { - }$ plus the impact of the metaorders of the day which is taken linear in their volume:

$$
\begin{array} { r c l } { { { \cal P } _ { S } ^ { + } } } & { { = } } & { { \displaystyle { \cal P } _ { 0 } ^ { - } + \kappa ( \sum _ { i = 1 } ^ { N _ { S } ^ { a } } v _ { i } ^ { a } - \sum _ { i = 1 } ^ { N _ { S } ^ { b } } v _ { i } ^ { b } ) + Z _ { S } } } \\ { { } } & { { = } } & { { \displaystyle { \cal P } _ { 0 } ^ { - } + \kappa ( V _ { S } ^ { a } - V _ { S } ^ { b } ) + Z _ { S } , } } \end{array}
$$

where $\kappa$ is a positive constant and $Z$ is a martingale random walk.

Finally, we consider the following assumption.

Assumption 3. The price $P$ is a martingale.

Assumption 3 implies that

$$
\begin{array} { r c l } { P _ { t } } & { = } & { \mathbb { E } [ P _ { S } ^ { + } | \mathcal { F } _ { t } ] } \\ & { = } & { P _ { 0 } ^ { - } + \mathbb { E } [ \kappa ( V _ { S } ^ { a } - V _ { S } ^ { b } ) | \mathcal { F } _ { t } ] + \mathbb { E } [ Z _ { S } | \mathcal { F } _ { t } ] , } \end{array}
$$

where $\mathcal { F } _ { t }$ is the information set of market participants at time $t$ .

The noise term $\mathbb { E } | Z _ { S } | \mathcal { F } _ { t } ]$ corresponds to price moves that are caused by other factors than volume (for example public announcements). For the sake of simplicity, we consider that $Z _ { S } = 0$ and thus

$$
P _ { t } = P _ { 0 } ^ { - } + \mathbb { E } [ \kappa ( V _ { S } ^ { a } - V _ { S } ^ { b } ) | \mathcal { F } _ { t } ] .
$$

Let us now extend the buy and sell market order flow processes to $\mathbb { R } _ { + }$ (until now they were only defined on a trading day $\vert 0 , S \vert$ ) and assume that these processes satisfy the following technical assumption.

Assumption 4. The quantity $\mathbb { E } [ V _ { s } ^ { a } - V _ { s } ^ { b } | \mathcal { F } _ { t } ]$ converges to some finite limit when s tends to infinity.

This assumption can be understood in this way: $\mathcal { F } _ { t }$ does not provide any information about the order flow imbalance which will occur at time $t ^ { \prime } \gg t$ . Indeed, under this assumption, for all $h > 0$ ,

$$
\mathbb { E } [ ( V _ { s + h } ^ { a } - V _ { s + h } ^ { b } ) - ( V _ { s } ^ { a } - V _ { s } ^ { b } ) | \mathcal { F } _ { t } ] \underset { s \to + \infty } { \to } 0 .
$$

Therefore, the order flow imbalance between $s$ and $s { + } h$ is asymptotically (in $s$ ) not predictable at time $t$ . For example, in the next section, we will assume that the market order flows are Hawkes processes for which this assumption is satisfied. Under this hypothesis, we have that if $S$ is large enough compared to the characteristic convergence scale of the function $s \mapsto \mathbb { E } [ V _ { s } ^ { a } - V _ { s } ^ { b } | { \mathcal { F } } _ { t } ]$ , when computing the price $P _ { t }$ , $S$ can be seen as infinity. This implies the main result of this paper.

Theorem 2.1. Under Assumptions 1, 2, 3 and 4

$$
P _ { t } = P _ { 0 } + \kappa \operatorname* { l i m } _ { s \to + \infty } \mathbb { E } [ V _ { s } ^ { a } - V _ { s } ^ { b } | \mathcal { F } _ { t } ] .
$$

Remark 2.7. To fix ideas, we have assumed that metaorders stop at the end of the day $S$ . However, some metaorders last days (or even weeks). Therefore, $S$ should thus not be considered as the end of the day but the end of a period that is very large compared to the execution of metaorders.

From Equation (1), and any example of order flow dynamics, we can thus derive a price process which satisfies the following properties:

• The price is a martingale even if the order flow exhibits persistence. • The permanent impact of a metaorder is linear in its size, independently of the execution. • The price process only depends on the global market order flow and not on the individual executions of metaorders. We thus do not need to assume that the market “sees” the execution of metaorders as it is usually done (see for example [16]).

Equation (1) can be seen as a rigorous and model independent generalization of the postulate “the impact is proportional to the innovation in the order flow” of [21] and [33]. Indeed, in our model, market orders move the price because they change the anticipation that market makers have about the future of the order flow. Furthermore, considering, as in Equation (1), that price moves are due to the “surprise in the order flow” (that is the variation of the expected cumulated order flow imbalance) is a general way to solve the following apparent “paradox” (which is one of the challenges of impact models): Order flows are persistent and yet prices are martingales.

From the empirical point of view, our framework is supported by [25] where it is shown that the trades of some arbitragers (namely high frequency traders) anticipate the order flows of other investors. Therefore, arbitragers move prices through their trades until it is no longer worth doing so; that is until the price correctly anticipates the future order flow imbalance.

In the next section, we give an example of realistic order flow dynamics and compute the associated price process. We will see that the linearity of the permanent impact of a metaorder is not incompatible with the observed concave power law impact functions.

# 3 Application to the Hawkes order flow example

We now want to apply Equation (1) to a reasonable example of market order flow dynamics. More precisely, we model the buy and sell market order flows as two independent (nearly unstable) stationary Hawkes processes which somehow reproduce the persistence of the sign of market orders. Applying Equation (1) to these processes, we derive a simple price model that is very similar to the propagator model of [11].

# 3.1 Impact of individual market orders

Before deriving the impact of individual market orders under the Hawkes order flow assumption, we need to introduce Hawkes processes and the propagator model.

# 3.1.1 Hawkes processes

Hawkes processes have been introduced in [23]. They have recently been applied to many fields of finance, see the references in introduction. For example, they were used to study tick by tick prices in [5] and order flows in [6]. We model the arrival times of buy and sell market orders as the jump times of two independent Hawkes processes.

Remark 3.1. We consider that all market orders have the same volume $\boldsymbol { v }$ .

By definition, a Hawkes process $N$ is a self exciting point process whose intensity $\lambda$ at time $t$ depends linearly on its past, see [23]:

$$
\lambda _ { t } = \mu + \int _ { 0 } ^ { t } \phi ( t - s ) d N _ { s } ,
$$

where $\mu$ is a positive constant and $\phi$ is a positive function supported on $\mathbb { R } _ { + }$ which satisfies the stability condition:

$$
\displaystyle \int _ { 0 } ^ { + \infty } \phi ( s ) d s < 1 .
$$

A nice property of Hawkes processes that we will use in order to compute the price dynamics is the following, see [4]:

Proposition 3.1. $\forall t \geq 0$ :

$$
\lambda _ { t } = \mu + \mu \int _ { 0 } ^ { t } \psi ( t - s ) d s + \int _ { 0 } ^ { t } \psi ( t - s ) d M _ { s } ,
$$

where $\begin{array} { r } { \psi = \sum _ { k = 1 } ^ { + \infty } \phi ^ { * k } } \end{array}$ , $\phi ^ { * k }$ being the $k ^ { t h }$ covolution product of $\phi$ and $d M _ { t } = d N _ { t } - \lambda _ { t } d t$ .

Therefore, since $M$ is a martingale and $\psi$ is supported on $\mathbb { R } _ { + }$ , for $0 \leq s , r \leq t$

$$
\mathbb { E } [ N _ { t } - N _ { s } | F _ { r } ] = \int _ { s } ^ { t } \mathbb { E } [ \lambda _ { u } | F _ { r } ] d u
$$

and

$$
\mathbb { E } [ \lambda _ { u } | F _ { r } ] = \mu + \mu \int _ { 0 } ^ { u } \psi ( u - x ) d x + \int _ { 0 } ^ { r } \psi ( u - x ) d M _ { x }
$$

This formula allows us to compute the anticipation of the order flow and will be very useful to apply Equation (1) in the Hawkes context.

Hawkes processes are a natural extension of Poisson processes and can be used to model the empirical clustering of same-sided trades. More precisely, we will later show that a Hawkes order flow can almost reproduce the empirical long memory of the signed flow of market orders.

# 3.1.2 Propagator model

In [11], the order flow is modelled as a FARIMA process that enables to obtain the long memory property of this flow observed in practice. In order to have a diffusive price, the authors propose a price impact model called propagator model where the impact of a market order does not depend on the past of the order flow but is transient (its permanent market impact is null). Proceeding essentially as in [20], this model can be extended to continuous time the following way:

Definition 3.1. A continuous time propagator model is an impact model where the price process $P$ is linked to the cumulated signed volume of market orders $V = V ^ { a } - V ^ { b }$ by:

$$
P _ { t } = P _ { 0 } + \int _ { 0 } ^ { t } \zeta ( t - s ) d V _ { s } ,
$$

where $\zeta$ is a decay kernel.

Remark 3.2. There is a small difference between this model and the model of [20]: In [20], $V$ is the trading rate of a given trader while here it is the order flow of all the market.

# 3.1.3 Computation of the price dynamics

From now on, we model the arrivals of buy and sell market orders as the points of two independent Hawkes processes $N ^ { a }$ and $N ^ { b }$ with identical kernel $\phi$ and exogenous intensity $\mu$ . We also assume that the volume of each market order is constant equal to $v$ .

Proposition 3.2. In the Hawkes order flow model, assuming that the price and volume satisfy the dynamics Equation (1), then the price process follows a propagator model:

$$
P _ { t } = P _ { 0 } + \int _ { 0 } ^ { t } \zeta ( t - s ) ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) ,
$$

with $\begin{array} { r } { \zeta ( t ) = \kappa v ( 1 + \int _ { t } ^ { + \infty } \psi ( u ) - \int _ { 0 } ^ { t } \psi ( u - s ) \phi ( s ) d s d u ) . } \end{array}$

The proof is given in appendix.

Let us notice that the kernel does not tend to $0$ since there is permanent impact.

Our propagator kernel $\zeta$ compensates the correlation of the order flow implied by the Hawkes kernel $\phi$ to recover a martingale price.

# 3.1.4 Properties of our propagator model

In this paragraph, we place ourselves in a general framework which includes the result of Proposition 3.2 and generalizes it to critical Hawkes order flows (with $\textstyle \int \phi = 1$ , see [13] for existence). We show that a continuous time propagator price model combined with a Hawkes order flow can lead to a martingale price under a simple condition on $\zeta$ and $\phi$ . We then use this condition to obtain a nicer expression of $\zeta$ . Indeed, if:

• The buy and sell market order flows are two independent Hawkes processes with kernel $\phi$ :

$$
\begin{array} { r } { \lambda ^ { a / b } = \mu + \int _ { 0 } ^ { t } \phi ( t - s ) d N _ { s } ^ { a / b } . } \end{array}
$$

• The price process follows a propagator model:

$$
\begin{array} { r } { P _ { t } = P _ { 0 } + \int _ { 0 } ^ { t } \zeta ( t - s ) ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) . } \end{array}
$$

Then,

• If there is no trade in $t$ , the price is differentiable in $t$ with derivative

$$
P _ { t } ^ { \prime } = \int _ { 0 } ^ { t } \zeta ^ { \prime } ( t - s ) ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) .
$$

• If there is a buy trade in $t$ (which happens with intensity $\begin{array} { r } { \lambda _ { t } ^ { a } = \mu + \int _ { 0 } ^ { t } \phi ( t - s ) d N _ { s } ^ { a } ) } \end{array}$ , the price jumps upward of $\zeta ( 0 )$ .   
• If there is a sell trade in $t$ (which happens with intensity $\begin{array} { r } { \lambda _ { t } ^ { b } = \mu + \int _ { 0 } ^ { t } \phi ( t - s ) d N _ { s } ^ { b } ) } \end{array}$ , the price jumps downward of $\zeta ( 0 )$ .

Therefore,

$$
\operatorname* { l i m } _ { h \to 0 } \frac { E [ P _ { t + h } | \mathcal { F } _ { t } ] - P _ { t } } { h } = \zeta ( 0 ) \int _ { 0 } ^ { t } \phi ( t - s ) ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) + \int _ { 0 } ^ { t } \zeta ^ { \prime } ( t - s ) ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) .
$$

Therefore, we have the following result:

Proposition 3.3. In the framework defined above, if the price is a martingale then:

$$
\zeta ^ { \prime } ( x ) = - \zeta ( 0 ) \phi ( x ) .
$$

Given a function $\zeta$ , we can compute a unique $\phi _ { \zeta }$ which satisfies (3). Conversely, given a $\phi$ and a $\zeta ( 0 )$ (or $\zeta$ anywhere else), we can compute a unique $\zeta _ { \phi }$ which satisfies (3).

Remark 3.3. Let us stress that in the general framework of this paragraph, the Hawkes order flows can be critical ( $\int \phi = 1 )$ . Moreover, the criticality of the Hawkes process is equivalent to the transience of the impact of a market order:

$$
\operatorname* { l i m } _ { x  + \infty } \zeta ( x ) = 0 \Leftrightarrow \int \phi = 1 .
$$

In this critical case, Assumption 4 is not satisfied. We are thus outside of the framework of Equation (1).

Going back to the framework of Proposition 3.2 (in which $\int \phi < 1 )$ , since our price $P _ { t }$ is an expectation conditionally on $\mathcal { F } _ { t }$ , it is by construction a martingale and therefore, the implied $\zeta$ must satisfy (3). Indeed, we have:

$$
\begin{array} { r c l } { { \zeta ^ { \prime } ( t ) } } & { { = } } & { { \kappa v [ - \psi ( t ) + \displaystyle \int _ { 0 } ^ { t } \psi ( t - s ) \phi ( s ) d s - \displaystyle \int _ { t } ^ { + \infty } \psi ( u - t ) \phi ( t ) d y ] } } \\ { { } } & { { = } } & { { \kappa v [ - \psi ( t ) + \psi * \phi ( t ) - \phi ( t ) | \psi | ] } } \\ { { } } & { { = } } & { { - \kappa v ( | \psi | + 1 ) \phi ( t ) } } \end{array}
$$

since

$$
\psi * \phi = \psi - \phi
$$

and thus

$$
\zeta ^ { \prime } ( t ) = - \zeta ( 0 ) \phi ( t ) .
$$

Theorem 3.1. In the setting of Proposition 3.2, we can get another expression for $\zeta$ :

$$
\zeta ( x ) = \zeta ( 0 ) ( 1 - \int _ { 0 } ^ { x } \phi ( s ) d s ) = \kappa v \frac { 1 } { 1 - \int \phi } ( ( 1 - \int \phi ) + \int _ { x } ^ { + \infty } \phi ( s ) d s ) .
$$

The ratio between the temporary and the permanent impact of an order satisfies

$$
\operatorname* { l i m } \zeta / \zeta ( 0 ) = 1 - \int \phi .
$$

Therefore, when $\int \phi$ is close to one which, we will see, corresponds to the apparent long memory asymptotic, the temporary impact is much larger than the permanent impact. This is due to the fact that in this asymptotic a market order on average “generates” a lot of market orders, see next paragraph.

# Cluster representation of Hawkes processes

In this paragraph, we recall the branching construction of Hawkes processes which will allow us to interpret $\int \phi$ in terms of market impact.

Let us define a population model (see the Introduction of [13]): At time zero, there are no individuals. Some individuals (migrants) arrive as a uniform Poisson process with intensity $\mu$ . If a migrant arrives at time $s$ , the birth dates of its children form a Poisson process of intensity $\phi ( . - s )$ , with $\int \phi < 1$ . In the same way, if a child is born in $s ^ { \prime }$ , the birth dates of its children form a Poisson process of intensity $\phi ( \ v r ) - \ v s s ^ { \prime } )$ . We call $N _ { t }$ the number of individuals who were born or migrated until $t$ . We have that $N$ is a point process of intensity

$$
\lambda _ { t } = \mu + \int _ { 0 } ^ { t } \phi ( t - s ) d N _ { s } ,
$$

and therefore, $N$ is a Hawkes process.

If we now name a cluster the set of all individuals who descend from the same migrant, a Hawkes process is the superposition of independent clusters which arrive at a rate $\mu$ . This is the Poisson cluster representation of Hawkes processes, see [24]. Replacing “individual” by “market order” and “cluster” by “metaorder”, a Hawkes process can be seen as the superposition of independent executions of metaorders. In this interpretation, the average size of a metaorder is $1 / ( 1 - \int \phi )$ . Therefore, when $\int \phi$ is close to one, a metaorder is on average made of a large number of market orders. The parameter $\int \phi$ can thus be seen as the degree of endogeneity of the market and has recently been the subject of many investigations, see [17], [22] and [27].

# 3.2 Impact of metaorders

In this paragraph, we study the impact of a large group of trades that we see as a metaorder in an asymptotic framework. To do so, we assume that the Hawkes order flows are nearly unstable (their kernel’s norm is close to one) which enables to retrieve the persistence property which is observed on the data.

# 3.2.1 Apparent long memory

It is well known that the sign of market orders presents long memory: Its autocorrelation function asymptotically behaves as a power law with exponent lower than one, see [31]. Recall that the Fourier transforms of the kernel $\phi$ and of the autocorrelation $C o v ( . , h )$ of the increments of length $h$ of a stationary Hawkes process (denoted respectively by $\hat { \phi }$ and $\widehat { C o v } ( . , h ) )$ are linked by:

$$
\widehat { C o v } ( z , h ) = h \frac { \frac { \mu } { 1 - \int \phi } \hat { g } _ { z } ^ { h } } { | 1 - \hat { \phi } ( z ) | ^ { 2 } } ,
$$

where $\hat { g } _ { z } ^ { h }$ is the Fourier transform of $g _ { \tau } ^ { h } = ( 1 - | \tau | / h ) ^ { + }$ , see [3].

Therefore, since

$$
\widehat { C o v } ( 0 , h ) = \int _ { 0 } ^ { \infty } C o v ( \tau , h ) d \tau
$$

and

$$
\int \phi = { \hat { \phi } } ( 0 ) ,
$$

the infinity of the integral of the correlation function, which defines long memory, implies that the norm of the kernel must be equal to one. Such “long memory” Hawkes processes have been studied in [13].

However, estimations performed in [6], [17] and [22] seem to show that $\int \phi$ is close to one but strictly lower than one ( $\int \phi \sim 0 . 9 )$ . Such nearly unstable Hawkes processes have been studied in [27], where it is shown that their diffusive limit is an integrated Cox-Ingersoll-Ross process. However, the latter work assumes that the shape of the kernel has an average in the sense that $\textstyle \int x \phi ( x ) d x < + \infty$ , which is not really in agreement with the power law persistence of the sign process. Qualitative arguments and numerical simulations presented in [6] show that taking a nearly unstable Hawkes process with $\phi$ behaving asymptotically as $1 / x ^ { 1 + \alpha }$ should lead to apparent long memory up to the time scale $1 / ( 1 - \textstyle \int \phi ) ^ { 1 / \alpha }$ (that is when the gap $\tau$ between the considered $h$ -increments is much lower than $1 / ( 1 - \int \phi ) ^ { 1 / \alpha } )$ . This is consistent with the empirical kernel estimations performed in the same paper.

In order to give a formal version of this statement, we proceed as in [27] and consider a sequence of renormalized Hawkes processes whose kernels’norm tends to one “faster” than the observation scale $T$ tends to infinity.

# Asymptotic framework

For every observation scale $T ' > 0$ , we define the stationary Hawkes process $N ^ { T }$ of exogenous intensity $\mu ^ { T } = C _ { \mu } ( 1 - a _ { T } ) T ^ { 2 \alpha - 1 }$ and of kernel $\phi ^ { T } = a _ { T } \Phi$ , where $\textstyle { \int } \Phi = 1$ and $( a _ { T } )$ is a sequence of positive real numbers smaller than one which tends to one as $T$ tends to infinity. Furthermore, we assume that

$$
\Phi ^ { ( \cal { x } ) } \underset { \cal { x }  + \infty } { \sim } \frac { \alpha c ^ { \alpha } } { x ^ { 1 + \alpha } } ,
$$

where $c > 0$ and $\alpha \in ] 0 , { \textstyle \frac { 1 } { 2 } } [$

Since $T$ is the observation scale, we consider the process $N _ { T t } ^ { T }$ that we renormalise by considering $X _ { t } ^ { T } : = A _ { T } N _ { T t } ^ { T }$ , with $A _ { T } = ( 1 - a _ { T } ) / ( T \mu ^ { T } ) = 1 / ( T ^ { 2 \alpha } )$ . Of course, $A _ { T }$ and $\mu ^ { T }$ are chosen so that the expectation and the covariance of the sequence of processes converge.

Considering the process at time scales below $1 / ( 1 - \int \phi ) ^ { 1 / \alpha }$ means that the observation scale $T$ is much smaller than $1 / ( 1 - a _ { T } ) ^ { 1 / \alpha }$ . It can be formally written the following way:

Assumption 5. $T ( 1 - a _ { T } ) ^ { 1 / \alpha }  0$ .

# Result

Let $h > 0$ be fixed, and the covariance of the $h$ -increments of $X ^ { T }$ be denoted by:

$$
\begin{array} { r } { C _ { \tau , h } ^ { X , T } : = C o v [ ( X _ { t + \tau + h } ^ { T } - X _ { t + \tau } ^ { T } ) , ( X _ { t + h } ^ { T } - X _ { t } ^ { T } ) ] . } \end{array}
$$

The following result holds.

Theorem 3.2. Under Assumption 5:

$$
C _ { \tau , h } ^ { X , T } \to C _ { \tau , h } ^ { X } = K ( | \tau + h | ^ { 2 H } + | \tau - h | ^ { 2 H } - 2 | \tau | ^ { 2 H } ) ,
$$

with $H = 1 / 2 + \alpha$ and $K$ is a constant explicitly given in the proof in appendix.

This limiting function satisfies the long memory property: for any $h > 0$ ,

$$
\begin{array} { r } { C _ { \tau , h } ^ { X } \underset { \tau \to + \infty } { \sim } \frac { C _ { h } } { \tau ^ { 1 - 2 \alpha } } . } \end{array}
$$

The proof is given in appendix.

Remark 3.4. Equation (5), corresponds exactly to the correlation function of a fractional Brownian motion of Hurst index $H$ .

Remark 3.5. A more precise behaviour of such “heavy tailed nearly unstable Hawkes processes” is heuristically discussed in [27].

In [6], it is shown that the time scale $1 / ( 1 - \int \phi ) ^ { 1 / \alpha }$ up to which a Hawkes process can present apparent long memory can be rather large ( $1 0 ^ { 3 }$ seconds). This implies that modelling financial order flows as nearly unstable Hawkes processes is consistent with their empirical apparent persistence.

# 3.2.2 Modelling metaorders

In the above framework, $N ^ { u }$ and $N ^ { b }$ are the flows of anonymous market orders. This corresponds to modelling the market from the point of view of a passive agent who does not use orders and does not know who uses the different orders. In order to compute the impact function of metaorders, it is convenient to look at the market from the point of view of someone who is executing a (buy) metaorder, see [6]. To do so, we consider that the total order flow is the sum of anonymous orders (which are modelled as two independent Hawkes processes as before) and labelled orders which correspond to “our” order flow. More precisely, during the execution of a metaorder, we model our order flow as a Poisson process $P ^ { F , \tau }$ of intensity $F$ on $\lfloor 0 , \tau \rfloor$ . The total buy and sell order flows are thus $N ^ { a } + P ^ { F , \tau }$ and $N ^ { b }$ .

Let us compute the impact function of a metaorder in our model. From the point of view of the rest of the market, there is no difference between our orders and anonymous orders. It thus seems natural to assume that the price impact of our orders is the same as the price impact of anonymous orders. Therefore, according to the propagator model:

$$
\begin{array} { r } { P _ { t } = P _ { 0 } + \int _ { 0 } ^ { t } \zeta ( t - s ) ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) + \int _ { 0 } ^ { t } \zeta ( t - s ) d P _ { s } ^ { F , \tau } . } \end{array}
$$

The processes $N ^ { a }$ and $N ^ { b }$ having the same average intensities, taking expectations, we get the following result:

Proposition 3.4. The impact function MI of a metaorder executed between 0 and $\tau$ is:

$$
M I ( t ) : = \mathbb { E } [ P _ { t } - P _ { 0 } ] = F \int _ { 0 } ^ { t \wedge \tau } \zeta ( t - s ) d s .
$$

# 3.2.3 Apparent power law impact function

Here, we consider that the Hawkes processes used to model the order flows are close to criticality (which corresponds to empirical measures, see Section 3.2.1). We show that if the length of the metaorder $\tau$ is small compared to the correlation scale $1 / ( 1 - \textstyle \int \phi ) ^ { 1 / \alpha }$ that appears in Section 3.2.1: $1 \ll \tau \ll 1 / ( 1 - \int \phi ) ^ { 1 / \alpha }$ , then the renormalized impact function is close to a power law with exponent $1 - \alpha$ .

In order to formally express and show this statement, we consider the same sequence of Hawkes processes as in Section 3.2.1. Let us also denote $( \tau ^ { T } ) _ { T }$ the sequence of sizes of metaorders. In the same vein as before, we formally write that the length of metaorders is small compared to the correlation scale as:

Assumption 6. $\tau ^ { T } \to + \infty$ and $\tau ^ { T } ( 1 - a _ { T } ) ^ { 1 / \alpha } \to 0$

Let us define the renormalized impact for $t \in \left[ 0 , 1 \right]$ :

$$
\begin{array} { r } { R M I ^ { T } ( t ) = \frac { 1 - a _ { T } } { ( \tau ^ { T } ) ^ { 1 - \alpha } } M I ^ { T } ( t \tau ^ { T } ) . } \end{array}
$$

We have the following result:

Theorem 3.3. Under Assumption $\it 6$ , the market impact is asymptotically a power law:

$$
R M I ^ { T } ( t ) \to K ^ { \prime } t ^ { 1 - \alpha } ,
$$

with K′ = cακvΦ .

The proof is given in appendix.

Of course, the renormalizing constant $( 1 - a _ { T } ) ( \tau ^ { T } ) ^ { \alpha - 1 }$ is chosen again so that the renormalized impact function converges. This power law impact function is close to the “square root law” which is empirically observed, see [34]. Let us now see how this impact exponent $\nu = 1 - \alpha$ can be linked to the order flow persistence exponent $\gamma$ .

# 3.2.4 Link between the exponents

For a price process implied by Equation (1) and for a Hawkes order flow with kernel whose norm is close to one and whose distribution tail is of order $1 / x ^ { 1 + \alpha }$ , we have shown that:

• The exponent of the long memory of the order flow is $\gamma = 1 - 2 \alpha$ , see Theorem 3.2.

• The exponent of the impact power law is $\nu = 1 - \alpha$ , see Theorem 3.3.

Therefore, we have:

$$
\nu = ( 1 + \gamma ) / 2 .
$$

On the data, $\gamma$ is stock dependent and seems to vary from 0.2 to 0.7, see [11], which in our framework implies that $\nu$ must vary between 0.6 and 0.85, which quite fits empirical data, see [34].

Remark 3.6. Theoretically retrieving the shape of the impact function from other market variables is an important problem in market microstructure. Three main possibilities have been suggested to solve it. The first one is to consider the risk aversion of investors and market makers as it is done in [18]. Another way is to consider statistical models for the flow of market orders and price changes as in [6]. Here we proceed somehow as in [10], [16] or [37] by introducing a martingale condition on the price which allows us to imply the impact function only from the order flow. Let us notice that the link between the exponent of the impact function and the exponent of the long memory of the order flow that we get is the same as in [6] and [10].

# 4 Conclusion

We have recalled why the permanent market impact of a metaorder should be linear. Using this linearity as well as a martingale hypothesis on the price, we have computed an impact equation (Equation (1)) that allows us to retrieve price dynamics from any order flow model. We applied it to the example of order flows modelled by nearly unstable Hawkes processes. In this model, the sign of market orders presents apparent long memory and we have shown that we can recover many stylized facts of market impact. In particular, we computed a power law impact function whose exponent is linked to the long memory of the sign of market orders.

The example of the Hawkes order flow allowed us to derive simple formulas on the future expectation of the volume. However, this model might be too simplistic. It would be interesting to consider more realistic frameworks such as the one presented in [32] where the order flow is really built as a superposition of independent metaorders. In addition to their natural interpretation, these order flow models manage to link the size distribution of metaorders to the long memory property of the order flow. However, such models are in a way much more complex and getting closed form prediction formulas for the order flow imbalance is probably very intricate.

# A Proofs

# A.1 Proof of Proposition 2.1

We proceed as in [19]:

For all $( v _ { 1 } , v _ { 2 } , T ) > 0$ , we consider that on $[ 0 , \theta T ]$ , we buy stock at a rate $v _ { 1 }$ and on $\lfloor \theta T , T \rfloor$ sell stock at a rate $v _ { 2 }$ . We take $\theta = v _ { 2 } / ( v _ { 1 } + v _ { 2 } )$ so that this strategy is a round trip. It is shown in [19] (Equation (4)) that the expectation of the cost of this strategy is:

$$
\begin{array} { r } { = v _ { 1 } f ( v _ { 1 } ) \int _ { 0 } ^ { \theta T } \int _ { 0 } ^ { t } G ( t - s ) d s d t + v _ { 2 } f ( v _ { 2 } ) \int _ { \theta T } ^ { T } \int _ { \theta T } ^ { t } G ( t - s ) d s d t - v _ { 2 } f ( v _ { 1 } ) \int _ { \theta T } ^ { T } \int _ { 0 } ^ { \theta T } G ( t - s ) d s d t } \end{array}
$$

Writing $G = G _ { \infty } + \tilde { G }$ with ${ \tilde { G } } = G - G _ { \infty }$

$$
\begin{array} { r c l } { { \frac { \gamma ( v _ { 1 } + v _ { 2 } ) { } ^ { 2 } } { T ^ { 2 } v _ { 1 } v _ { 2 } } } } & { { = } } & { { \displaystyle \frac { 1 } { 2 } G _ { \infty } ( f ( v _ { 1 } ) v _ { 2 } - f ( v _ { 2 } ) v _ { 1 } ) } } \\ { { } } & { { + } } & { { \displaystyle \frac { ( v _ { 1 } + v _ { 2 } ) ^ { 2 } } { v _ { 1 } v _ { 2 } } \biggl ( v _ { 1 } f ( v _ { 1 } ) \int _ { 0 } ^ { \theta } \frac { 1 } { T } \int _ { 0 } ^ { t T } { \tilde { G } } ( s ) d s d t + v _ { 2 } f ( v _ { 2 } ) \int _ { \theta } ^ { 1 } \frac { 1 } { T } \int _ { 0 } ^ { T ( t - \theta ) } { \tilde { G } } ( s ) d s d t } } \\ { { } } & { { - } } & { { v _ { 2 } f ( v _ { 1 } ) \displaystyle \int _ { \theta } ^ { 1 } \frac { 1 } { T } \int _ { T ( t - \theta ) } ^ { T t } { \tilde { G } } ( s ) d s d t \biggr ) . } } \end{array}
$$

Therefore, using Ces\`aro’s lemma (applied to $\tilde { G }  0$ ), we show that only the first term does not tend to zero when $T$ tends to infinity and thus for $E$ not to be strictly negative when $T$ becomes large enough, we must have: $v _ { 1 } f ( v _ { 2 } ) \leq v _ { 2 } f ( v _ { 1 } )$ .

Symmetrically, we get: $v _ { 1 } f ( v _ { 2 } ) = v _ { 2 } f ( v _ { 1 } )$ therefore $f$ must be linear.

# A.2 Proof of Theorem 3.2

Let us write:

$$
\theta ( x ) = \int _ { 0 } ^ { + \infty } \frac { e ^ { i u } } { u ^ { x } } d u \mathrm { ~ f o r ~ } x \in ] 0 , 1 [ \mathrm { ~ a n d ~ } \theta ( x ) = \int _ { 0 } ^ { + \infty } \frac { e ^ { i u } - 1 } { u ^ { x } } d u
$$

By definition of $X ^ { T }$ , the covariance of its $h$ -increments is linked to the covariance of the T h-increments of NT by6

$$
C _ { \tau , h } ^ { X , T } = A _ { T } ^ { 2 } C _ { T \tau , T h } ^ { N , T } .
$$

Let us now compute the Fourier transform of the correlation function of the $h$ -increments of $X ^ { T }$ . For a fixed $z \in \mathbb { R } ^ { * }$ , we have

$$
\hat { C } _ { z , h } ^ { X , T } = \int _ { - \infty } ^ { + \infty } C _ { \tau , h } ^ { X , T } e ^ { i z \tau } d \tau = \frac { A _ { T } ^ { 2 } } { T } \hat { C } _ { \frac { z } { T } , T h } ^ { N , T } .
$$

Theorem $^ 1$ of [3] yields

$$
\hat { C } _ { \frac { z } { T } , T h } ^ { N , T } = T h \frac { \frac { \mu ^ { T } } { 1 - a _ { T } } \hat { g } _ { \frac { z } { T } } ^ { T h } } { | 1 - \hat { \phi } _ { \frac { z } { T } } ^ { T } | ^ { 2 } } = T h \frac { \frac { \mu ^ { T } } { 1 - a _ { T } } T \hat { g } _ { z } ^ { h } } { | 1 - \hat { \phi } _ { \frac { z } { T } } ^ { T } | ^ { 2 } }
$$

with $\begin{array} { r } { g _ { t } ^ { u } = ( 1 - \frac { | t | } { u } ) ^ { + } } \end{array}$

We now state the following technical lemma.

Lemma A.1. For $z \in \mathbb { R } ^ { * }$

$$
\hat { \phi } _ { \frac { z } { T } } ^ { T } = a _ { T } \Big [ 1 + \theta \big ( 1 + \alpha \big ) \alpha \big ( \frac { c z } { T } \big ) ^ { \alpha } + o \big ( \frac { 1 } { T ^ { \alpha } } \big ) \Big ] .
$$

Proof. The Fourier transform writes:

$$
\begin{array} { r c l } { { \hat { \phi } _ { \frac { z } { T } } ^ { T } } } & { { = } } & { { \displaystyle \int _ { 0 } ^ { + \infty } \phi ^ { T } ( t ) e ^ { i t \frac { z } { T } } d t } } \\ { { } } & { { = } } & { { \displaystyle \int _ { 0 } ^ { + \infty } \phi ^ { T } ( t ) d t + \int _ { 0 } ^ { + \infty } \phi ^ { T } ( t ) ( e ^ { i t \frac { z } { T } } - 1 ) d t } } \\ { { } } & { { = } } & { { \displaystyle a _ { T } \big ( 1 + T ^ { - \alpha } \int _ { 0 } ^ { + \infty } \phi ( \frac { T u } { z } ) ( e ^ { i u } - 1 ) \frac { T ^ { 1 + \alpha } } { z } d u \big ) . } } \end{array}
$$

However, for a fixed $u > 0$ , our hypothesis on the asymptotic behaviour of $\phi$ implies:

$$
\phi ( \frac { T u } { z } ) ( e ^ { i u } - 1 ) \frac { T ^ { 1 + \alpha } } { z }  ( e ^ { i u } - 1 ) \frac { \alpha c ^ { \alpha } z ^ { \alpha } } { u ^ { 1 + \alpha } } .
$$

Moreover, since $\phi$ is bounded, there exists $C > 0$ such that $\begin{array} { r } { | \phi ( x ) | \le \frac { C } { x ^ { 1 + \alpha } } } \end{array}$ and thus

$$
| \phi ( \frac { T u } { z } ) ( e ^ { i u } - 1 ) \frac { T ^ { 1 + \alpha } } { z } | \leq z ^ { \alpha } \frac { C } { u ^ { 1 + \alpha } } | e ^ { i u } - 1 | .
$$

We can therefore apply the dominated convergence theorem to obtain the lemma.

$$
^ { 6 } C _ { \tau , h } ^ { X , T } = \mathbb { E } [ ( X _ { t + \tau + h } ^ { T } - X _ { t + \tau } ^ { T } ) ( X _ { t + h } ^ { T } - X _ { t } ^ { T } ) ] - ( \mathbb { E } [ X _ { t + h } ^ { T } - X _ { t } ^ { T } ] ) ^ { 2 } .
$$

Using Lemma A.1, we get that

$$
\hat { \cal C } _ { \frac { z } { T } , T h } ^ { N , T } = h T ^ { 2 } \frac { \frac { \mu ^ { T } } { 1 - a _ { T } } } { | \theta ( 1 + \alpha ) | ^ { 2 } ( \frac { c } { T } ) ^ { 2 \alpha } a _ { T } ^ { 2 } \alpha ^ { 2 } } \frac { \hat { g } _ { z } ^ { h } } { | z | ^ { 2 \alpha } } \Big [ 1 + o ( 1 ) + { \cal O } \big ( T ^ { \alpha } ( 1 - a _ { T } ) \big ) \Big ] .
$$

Replacing $\mu ^ { T }$ by its expression, leads to

$$
\operatorname* { l i m } _ { T \to + \infty } \hat { C } _ { z , h } ^ { X , T } = \frac { h C _ { \mu } } { | \theta ( 1 + \alpha ) | ^ { 2 } c ^ { 2 \alpha } \alpha ^ { 2 } } \frac { \hat { g } _ { z } ^ { h } } { | z | ^ { 2 \alpha } } .
$$

Let us now state a domination lemma for $\hat { C } _ { z , h } ^ { X , I }$ .

Lemma A.2. There is a constant $C > 0$ such that for all $z \in \mathbb { R } ^ { * }$

$$
| \hat { C } _ { z , h } ^ { X , T } | \leq C \operatorname* { m i n } ( \frac { 1 } { | z | ^ { 2 } } , 1 ) ( 1 + \frac { 1 } { z ^ { 2 \alpha } } ) .
$$

Proof. We begin the proof by noticing that there exist $c _ { 1 } > 0$ and $c _ { 2 } > 0$ such that

$$
| \hat { g } _ { z } ^ { h } | \leq c _ { 1 } \operatorname* { m i n } ( \frac { 1 } { | z | ^ { 2 } } , 1 )
$$

and

$$
| 1 - \hat { \phi } _ { \frac { z } { T } } ^ { T } | \geq c _ { 2 } \operatorname* { m i n } ( \big | \frac { z } { T } \big | ^ { \alpha } , 1 ) .
$$

If we now use these inequalities together with Theorem $^ { 1 }$ of [3] and the definition of $X ^ { T }$ , we obtain

$$
| \hat { C } _ { z , h } ^ { X , T } | \leq \frac { h C _ { \mu } T ^ { - 2 \alpha } } { c _ { 2 } ^ { 2 } \operatorname* { m i n } ( \left| \frac { z } { T } \right| ^ { \alpha } , 1 ) ^ { 2 } } c _ { 1 } \operatorname* { m i n } ( \frac { 1 } { | z | ^ { 2 } } , 1 )
$$

which ends the proof.

The Fourier transform inversion formula writes

$$
C _ { t , h } ^ { X , T } = \frac { 1 } { 2 \pi } \int _ { - \infty } ^ { + \infty } \hat { C } _ { z , h } ^ { X , T } e ^ { - i t z } d z .
$$

Thanks to the previous lemma, we can use the dominated convergence theorem to get that for a fixed $t$ , $C _ { t , h } ^ { X , I ^ { \prime } }$ has a limit when $T$ tends to infinity and

$$
C _ { t , h } ^ { X } : = \operatorname* { l i m } _ { T \to + \infty } C _ { t , h } ^ { X , T } = \frac { 1 } { 2 \pi } \int _ { - \infty } ^ { + \infty } \frac { h C _ { \mu } } { | \theta ( 1 + \alpha ) | ^ { 2 } c ^ { 2 \alpha } \alpha ^ { 2 } } \frac { \hat { g } _ { z } ^ { h } } { | z | ^ { 2 \alpha } } e ^ { - i t z } d z .
$$

We now state the following lemma which is given by a simple change of variables.

Lemma A.3. The function whose Fourier transform is $\begin{array} { r } { | z | ^ { - 2 \alpha } ~ i s ~ \frac { 1 } { 2 R e \big ( \theta ( 1 - 2 \alpha ) \big ) | t | ^ { 1 - 2 \alpha } } , } \end{array}$

Therefore, if we set $\begin{array} { r } { K = \frac { h C _ { \mu } } { 2 R e \big ( \theta ( 1 - 2 \alpha ) \big ) | \theta ( 1 + \alpha ) | ^ { 2 } c ^ { 2 \alpha } \alpha ^ { 2 } } } \end{array}$ , then the function $\begin{array} { r } { t \mapsto K g _ { t } ^ { h } * \frac { 1 } { | t | ^ { 1 - 2 \alpha } } } \end{array}$ has the same Fourier transform as $C _ { t , h } ^ { X }$ and thus

$$
\operatorname* { l i m } _ { T \to + \infty } C _ { t , h } ^ { X , T } = K g _ { t } ^ { h } * \frac { 1 } { | t | ^ { 1 - 2 \alpha } } .
$$

Computing the convolution ends the proof:

# A.3 Proof of Proposition 3.2

Starting from Equation (1):

$$
P _ { t } = P _ { 0 } + \kappa v \operatorname* { l i m } _ { s  + \infty } \mathbb { E } [ N _ { s } ^ { a } - N _ { s } ^ { b } | \mathcal { F } _ { t } ] .
$$

We rewrite N a/bs = $\begin{array} { r } { N _ { s } ^ { a / b } = M _ { s } ^ { a / b } + \int _ { 0 } ^ { s } \lambda ^ { a / b } d u } \end{array}$ which implies:

$$
P _ { t } = P _ { 0 } + \kappa v \operatorname* { l i m } _ { s \to + \infty } \mathbb { E } [ M _ { s } ^ { a } - M _ { s } ^ { b } + \int _ { 0 } ^ { t } \lambda _ { u } ^ { a } - \lambda _ { u } ^ { b } d u + \int _ { t } ^ { s } \lambda _ { u } ^ { a } - \lambda _ { u } ^ { b } d u | \mathcal { F } _ { t } ] .
$$

We use proposition 3.1 to replace $\lambda ^ { a / b }$ and we get:

$$
P _ { t } = P _ { 0 } + \kappa v \operatorname* { l i m } _ { s  + \infty } \mathbb { E } [ M _ { s } ^ { a } - M _ { s } ^ { b } + \int _ { 0 } ^ { t } \lambda _ { u } ^ { a } - \lambda _ { u } ^ { b } d u + \int _ { t } ^ { s } \int _ { 0 } ^ { u } \psi ( u - x ) ( d M _ { x } ^ { a } - d M _ { x } ^ { b } ) d u | \mathcal { F } _ { t } ] .
$$

Using that $M ^ { a / b }$ is a martingale and that:

$$
\begin{array} { r } { d M _ { x } = d N _ { x } - \lambda _ { x } d x = d N _ { x } - ( \mu + \int _ { 0 } ^ { t } \phi ( x - r ) d N _ { r } ) d x , } \end{array}
$$

we get:

$$
\begin{array} { r c l } { { P _ { t } } } & { { = } } & { { P _ { 0 } + \kappa v [ N _ { t } ^ { a } - N _ { t } ^ { b } + { \displaystyle \int _ { t } ^ { + \infty } } \int _ { 0 } ^ { t } \psi ( u - x ) ( d N _ { x } ^ { a } - d N _ { x } ^ { b } ) d u } } \\ { { } } & { { + } } & { { \displaystyle \int _ { t } ^ { + \infty } } \int _ { 0 } ^ { t } \psi ( u - x ) \int _ { 0 } ^ { x } \phi ( x - r ) ( d N _ { r } ^ { a } - d N _ { r } ^ { b } ) d x d u ] . }  \end{array}
$$

Inverting the integrals in the previous equation, we get:

$$
N _ { t } ^ { a } - N _ { t } ^ { b } = \int _ { 0 } ^ { t } ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) ,
$$

and

$$
\begin{array} { r l l } { \displaystyle \int _ { t } ^ { \infty } \int _ { 0 } ^ { t } \psi ( u - x ) ( d N _ { x } ^ { a } - d N _ { x } ^ { b } ) d u } & { = } & { \displaystyle \int _ { 0 } ^ { t } \int _ { t } ^ { \infty } \psi ( u - x ) d u ( d N _ { x } ^ { a } - d N _ { x } ^ { b } ) } \\ & { = } & { \displaystyle \int _ { 0 } ^ { t } \int _ { t - s } ^ { \infty } \psi ( u ^ { \prime } ) d u ^ { \prime } ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) . } \end{array}
$$

Moreover

$$
\begin{array} { l l l } { { } } & { { \displaystyle \int _ { t } ^ { \infty } \int _ { 0 } ^ { t } \psi ( u - x ) \int _ { 0 } ^ { x } \phi ( x - r ) ( d N _ { r } ^ { a } - d N _ { r } ^ { b } ) d x d u } } \\ { { } } & { { = } } & { { \displaystyle \int _ { 0 } ^ { t } \int _ { t } ^ { \infty } \int _ { r } ^ { t } \psi ( u - x ) \phi ( x - r ) d x d u ( d N _ { r } ^ { a } - d N _ { r } ^ { b } ) } } \\ { { } } & { { = } } & { { \displaystyle \int _ { 0 } ^ { t } \int _ { t - s } ^ { \infty } \int _ { 0 } ^ { t - s } \psi ( u ^ { \prime } - x ^ { \prime } ) \phi ( x ^ { \prime } ) d x ^ { \prime } d u ^ { \prime } ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) , } } \end{array}
$$

where we have made the changes of variables: $u ^ { \prime } = u - r$ and $x ^ { \prime } = x - r$ Replacing those three terms in the previous equation ends the proof:

$$
P _ { t } = P _ { 0 } + \kappa v \Big [ \int _ { 0 } ^ { t } ( 1 + \int _ { t - s } ^ { + \infty } \psi ( u ) d u - \int _ { t - s } ^ { + \infty } \int _ { 0 } ^ { t - s } \psi ( u - x ) \phi ( x ) d x d u ) ( d N _ { s } ^ { a } - d N _ { s } ^ { b } ) \Big ] .
$$

# A.4 Proof of Theorem 3.3

We start from the impact equation (6), that we apply to our asymptotic:

$$
\begin{array} { l c l } { { R M I ^ { T } ( t ) } } & { { = } } & { { \displaystyle F \frac { 1 - a _ { T } } { ( \tau ^ { T } ) ^ { 1 - \alpha } } \int _ { 0 } ^ { t \tau ^ { T } } \zeta ^ { T } ( s ) d s } } \\ { { } } & { { = } } & { { \displaystyle F \frac { 1 - a _ { T } } { ( \tau ^ { T } ) ^ { 1 - \alpha } } \int _ { 0 } ^ { t } \frac { \kappa v \tau ^ { T } } { ( 1 - a _ { T } ) ( \tau ^ { T } ) ^ { \alpha } } \Big [ ( 1 - a _ { T } ) ( \tau ^ { T } ) ^ { \alpha } + \int _ { s \tau ^ { T } } ^ { + \infty } \phi ^ { T } ( x ) d x ( \tau ^ { T } ) ^ { \alpha } \Big ] d s } } \\ { { } } & { {  } } & { { \kappa v F \int _ { 0 } ^ { t } \frac { c ^ { \alpha } } { s ^ { 1 - \alpha } } d s = \frac { c ^ { \alpha } \kappa v \Phi } { 1 - \alpha } t ^ { 1 - \alpha } . } } \end{array}
$$

Using the dominated convergence theorem with $( 1 - a _ { T } ) ( \tau ^ { T } ) ^ { \alpha } \ :  \ : 0$ and $\begin{array} { r } { \int _ { s \tau ^ { T } } ^ { + \infty } \phi ^ { T } ( x ) d x \sim } \end{array}$ $c ^ { \alpha } / { \left( ( \tau ^ { T } s ) ^ { \alpha } \right) }$ ends the proof.

# References

[1] Y. A¨ıt-Sahalia, J. Cacho-Diaz, and R. J. Laeven. Modeling financial contagion using mutually exciting jump processes. Technical report, National Bureau of Economic Research, 2010.   
[2] R. Almgren and N. Chriss. Optimal execution of portfolio transactions. Journal of Risk, 3:5–40, 2001.   
[3] E. Bacry, K. Dayri, and J.-F. Muzy. Non-parametric kernel estimation for symmetric Hawkes processes. Application to high frequency financial data. The European Physical Journal B, 85(5):1–12, 2012.   
[4] E. Bacry, S. Delattre, M. Hoffmann, and J. F. Muzy. Scaling limits for hawkes processes and application to financial statistics. arXiv preprint arXiv:1202.0842, 2012.   
[5] E. Bacry, S. Delattre, M. Hoffmann, and J.-F. Muzy. Modelling microstructure noise with mutually exciting point processes. Quantitative Finance, 13(1):65–77, 2013.   
[6] E. Bacry and J.-F. Muzy. Hawkes model for price and trades high-frequency dynamics. arXiv preprint arXiv:1301.1135, 2013.   
[7] J. Beran. Statistics for long-memory processes, volume 61. CRC Press, 1994.   
[8] N. Bershova and D. Rakhlin. The non-linear market impact of large trades: Evidence from buy-side order flow. Available at SSRN 2197534, 2013.   
[9] J.-P. Bouchaud. Price impact. Encyclopedia of Quantitative Finance, 2010.   
[10] J.-P. Bouchaud, J. Farmer, and F. Lillo. How markets slowly digest changes in supply and demand. Fabrizio, How Markets Slowly Digest Changes in Supply and Demand (September 11, 2008), 2008.   
[11] J.-P. Bouchaud, Y. Gefen, M. Potters, and M. Wyart. Fluctuations and response in financial markets: The subtle nature of “random” price changes. Quantitative Finance, 4(2):176–190, 2004.   
[12] C. G. Bowsher. Modelling security market events in continuous time: Intensity based, multivariate point process models. Journal of Econometrics, 141(2):876–912, 2007.   
[13] P. Br´emaud and L. Massouli´e. Hawkes branching point processes without ancestors. Journal of applied probability, 38(1):122–135, 2001.   
[14] J. Donier. Market impact with autocorrelated order flow under perfect competition. Available at SSRN 2191660, 2012.   
[15] E. Errais, K. Giesecke, and L. R. Goldberg. Affine point processes and portfolio credit risk. SIAM Journal on Financial Mathematics, 1(1):642–665, 2010.   
[16] J. D. Farmer, A. Gerig, F. Lillo, and H. Waelbroeck. How efficiency shapes market impact. arXiv preprint arXiv:1102.5457, 2011.   
[17] V. Filimonov and D. Sornette. Apparent criticality and calibration issues in the hawkes self-excited point process model: Application to high-frequency financial data. arXiv preprint arXiv:1308.6756, 2013.   
[18] X. Gabaix, P. Gopikrishnan, V. Plerou, and H. E. Stanley. Institutional investors and stock market volatility. The Quarterly Journal of Economics, 121(2):461–504, 2006.   
[19] J. Gatheral. No-dynamic-arbitrage and market impact. Quantitative Finance, 10(7):749– 759, 2010.   
[20] J. Gatheral, A. Schied, and A. Slynko. Transient linear price impact and Fredholm integral equations. Mathematical Finance, 22(3):445–474, 2012.   
[21] L. R. Glosten and P. R. Milgrom. Bid, ask and transaction prices in a specialist market with heterogeneously informed traders. Journal of financial economics, 14(1):71–100, 1985.   
[22] S. J. Hardiman, N. Bercot, and J.-P. Bouchaud. Critical reflexivity in financial markets: A hawkes process analysis. arXiv preprint arXiv:1302.1405, 2013.   
[23] A. G. Hawkes. Point spectra of some mutually exciting point processes. Journal of the Royal Statistical Society. Series B (Methodological), pages 438–443, 1971.   
[24] A. G. Hawkes and D. Oakes. A cluster process representation of a self-exciting process. Journal of Applied Probability, pages 493–503, 1974.   
[25] N. Hirschey. Do high frequency traders anticipate buying and selling pressure. Work. Pap., McCombs Sch. Bus., Univ. Texas Austin, 2011.   
[26] G. Huberman and W. Stanzl. Price manipulation and quasi-arbitrage. Econometrica, 72(4):1247–1275, 2004.   
[27] T. Jaisson and M. Rosenbaum. Limit theorems for nearly unstable Hawkes processes. To appear in Annals of Applied Probability, 2013.   
[28] A. P. Kyle and A. Obizhaeva. Market microstructure invariants: Theory and implications of calibration. Available at SSRN 1978932, 2011.   
[29] A. S. Kyle. Continuous auctions and insider trading. Econometrica: Journal of the Econometric Society, pages 1315–1335, 1985.   
[30] J. Large. Measuring the resiliency of an electronic limit order book. Journal of Financial Markets, 10(1):1–25, 2007.   
[31] F. Lillo and J. D. Farmer. The long memory of the efficient market. Studies in Nonlinear Dynamics & Econometrics, 8(3), 2004.   
[32] F. Lillo, S. Mike, and J. D. Farmer. Theory for long memory in supply and demand. Physical Review E, 71(6):066122, 2005.   
[33] A. Madhavan, M. Richardson, and M. Roomans. Why do security prices change? A transaction-level analysis of NYSE stocks. Review of Financial Studies, 10(4):1035–1064, 1997.   
[34] E. Moro, J. Vicente, L. G. Moyano, A. Gerig, J. D. Farmer, G. Vaglica, F. Lillo, and R. N. Mantegna. Market impact and trading profile of hidden orders in stock markets. Physical Review E, 80(6):066102, 2009.   
[35] W. F. Sharpe. Capital asset prices: A theory of market equilibrium under conditions of risk. The journal of finance, 19(3):425–442, 1964.   
[36] R. J. Shiller. Do stock prices move too much to be justified by subsequent changes in dividends? National Bureau of Economic Research Cambridge, Mass., USA, 1980.   
[37] B. Toth, Y. Lemperiere, C. Deremble, J. De Lataillade, J. Kockelkoren, and J.-P. Bouchaud. Anomalous price impact and the critical nature of liquidity in financial markets. Physical Review X, 1(2):021006, 2011.   
[38] B. Toth, I. Palit, F. Lillo, and J. D. Farmer. Why is order flow so persistent? arXiv preprint arXiv:1108.1632, 2011.   
[39] H. Waelbroeck and C. Gomes. Is market impact a measure of the information value of trades? Market response to liquidity vs. informed trades. Market Response to liquidity vs. Informed Trades (July 9 2013), 2013.