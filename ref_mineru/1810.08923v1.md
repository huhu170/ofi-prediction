# CNNPred: CNN-based stock market prediction using several data sources

Ehsan Hoseinzade $^ \mathrm { a }$ , Saman Haratizadeh $\mathbf { a }$

$^ a$ Faculty of New Sciences and Technologies, University of Tehran, North Kargar Street, 1439957131 Tehran, Iran

# Abstract

Feature extraction from financial data is one of the most important problems in market prediction domain for which many approaches have been suggested. Among other modern tools, convolutional neural networks (CNN) have recently been applied for automatic feature selection and market prediction. However, in experiments reported so far, less attention has been paid to the correlation among different markets as a possible source of information for extracting features. In this paper, we suggest a CNN-based framework with specially designed CNNs, that can be applied on a collection of data from a variety of sources, including different markets, in order to extract features for predicting the future of those markets. The suggested framework has been applied for predicting the next days direction of movement for the indices of S&P 500, NASDAQ, DJI, NYSE, and RUSSELL markets based on various sets of initial features. The evaluations show a significant improvement in predictions performance compared to the state of the art baseline algorithms.

Keywords: Stock markets prediction, Deep learning, Convolutional neural networks, CNN, Feature extraction

# 1. Introduction

Financial markets are considered as the heart of the worlds economy in which billions of dollars are traded every day. Clearly, a good prediction of future behavior of markets would be extremely valuable for the traders. However, due to the dynamic and noisy behavior of those markets, making such a prediction is also a very challenging task that has been the subject of research for many years. In addition to the stock market index prediction, forecasting the exchange rate of currencies, price of commodities and cryptocurrencies like bitcoin are examples of prediction problems in this domain (Shah & Zhang, 2014; Zhao et al., 2017; Nassirtoussi et al., 2015; Lee et al., 2017).

Existing approaches for financial market analysis fall into two main groups of fundamental analysis and technical analysis. In technical analysis, historical data of the target market and some other technical indicators are regarded as important factors for prediction. According to the efficient market hypothesis, the price of stocks reflects all the information about them (Fama, 1970) while technical analysts believe that prediction of future behavior of the prices in a market is possible by analyzing the previous price data. On the other hand, fundamental analysts examine securities intrinsic value for investment. They look at balance sheets, income statements, cash flow statements and so on to gain insight into future of a company.

In addition to financial market experts, machine learning techniques have proved to be useful for making such predictions. Artificial neural networks and support vector machine are the most common algorithms that have been utilized for this purpose (Guresen et al., 2011; Kara et al., 2011; Wang & Wang, 2015). Statistical methods, random forests (Khaidem et al., 2016), linear discriminant analysis, quadratic discriminant analysis, logistic regression and evolutionary computing algorithms, especially genetic algorithm, (Hu et al., 2015b; Brown et al., 2013; Hu et al., 2015a; Atsalakis & Valavanis, 2009) are among other tools and techniques that have been applied for feature extraction from raw financial data and/or making predictions based on a set of features (Ou & Wang, 2009;

Ballings et al., 2015).

Deep learning (DL) is a class of modern tools that is suitable for automatic features extraction and prediction (LeCun et al., 2015). In many domains, such as machine vision and natural language processing, DL methods have been shown to be able to gradually construct useful complex features from raw data or simpler features (He et al., 2016; LeCun et al., 2015). Since the behavior of stock markets is complex, nonlinear and noisy, it seems that extracting features that are informative enough for making predictions is a core challenge, and DL seems to be a promising approach to that. Algorithms like Deep Multilayer Perceptron (MLP) (Yong et al., 2017), Restricted Boltzmann Machine (RBM) (Cai et al., 2012; Zhu et al., 2014), Long Short-Term Memory (LSTM) (Chen et al., 2015; Fischer & Krauss, 2018), Auto-Encoder (AE) (Bao et al., 2017) and Convolutional Neural Network (CNN) (Gunduz et al., 2017; Di Persio & Honchar, 2016) are famous deep learning algorithms utilized to predict stock markets.

It is important to pay attention to the diversity of the features that can be used for making predictions. The raw price data, technical indicators which come out of historical data, other markets with connection to the target market, exchange rates of currencies, oil price and many other information sources can be useful for a market prediction task. Unfortunately, it is usually not a straightforward task to aggregate such a diverse set of information in a way that an automatic market prediction algorithm can use them. So, most of the existing works in this field have limited themselves to a set of technical indicators representing a single markets recent history (Kim, 2003; Zhang & Wu, 2009).

Another important subject in the field is automatic feature extraction. Since the initial features are defined to be used by human experts, they are simple and even if they were chosen by a finance expert who has enough knowledge and experience in this domain, they may not be the best possible choices for making predictions by machines. In other words, an automatic approach to stock market prediction ideally is one that can extract useful features from different sources of information that seem beneficial for market prediction, train a prediction model based on those extracted features and finally make predictions using the resulted model. The focus of this paper is on the first phase of this process, that is to design a model for extracting features from several data sources that contain information from historical records of relevant markets. This data includes initial basic features such as raw historical prices, technical indicators or fluctuation of those features in the past days. Regarding the diversity of the input space and possible complexity of the feature space that maybe required for a good prediction, a deep learning algorithm like CNN seems to be a promising approach for such a feature extraction problem.

To the best of our knowledge, convolutional neural networks, CNN, has been applied in a few studies for stock market prediction (Gunduz et al., 2017; Di Persio & Honchar, 2016). Periso & Honchar (Di Persio & Honchar, 2016) used a CNN which took a one-dimensional input for making prediction only based on the history of closing prices while ignoring other possible sources of information like technical indicators. Gunduz et al. (Gunduz et al., 2017) took advantage of a CNN which was capable of using technical indicators as well for each sample. However, it was unable to consider the correlation which could exist between stock markets as another possible source of information. In addition, structure of used CNN was inspired by previous works in Computer Vision, while there is fundamental difference between Computer Vision and Stock market prediction. Since in stock market prediction features interaction are radically different from pixels interaction with each other, using $3 \times 3$ or $5 \times 5$ filters in convolutional layer may not be the best option. It seems cleverer to design filters of CNN based on financial facts instead of papers in Computer Vision.

We develop our framework based on CNN due to its proven capabilities in other domains as well as mentioned successful past experiments reported in market prediction domain. As a test case, we will show how CNN can be applied in our suggested framework, that we call CNNpred, to capture the possible correlations among different sources of information for extracting combined features from a diverse set of input data from five major U.S. stock market indices: S&P 500, NASDAQ, Dow Jones Industrial Average, NYSE and RUSSELL, as well as other sources of information including economic data, exchange rate of currencies, future contracts, price of commodities, important indices of markets around the world and price of major companies in U.S. market. Furthermore, the filters are designed in a way that is compatible with financial characteristic of features.

The main contributions of this work can be summarized as follows:

• Aggregating several sources of information in a CNN-based framework for feature extraction and market prediction. Since financial markets behavior is affected by many factors, it is important to gather related information as much as possible. Our initial feature set covers different aspects of stock related sources of data pretty well and basically, it can be easily extended to cover other possible sources of information.   
• To our knowledge, this is the first work suggesting a CNN which takes a 3-dimensional tensor aggregating and aligning a diverse set of features as input and is trained to extract features useful for predicting each of the pertinent stock markets afterward.

The rest of this paper is organized as follows: In section 2, related works and researches are presented. Then, in section 3, we introduce a brief background on related techniques in the domain. In section 4, the proposed method is presented in details followed by introduction of various utilized features in section 5. Our experimental setting and results are reported in section 6. In section 7 we discuss the results and there is a conclusion in section 8.

# 2. Related works

Different methods in stock prediction domain can be categorized into two groups. The first class includes algorithms try to improve the performance of prediction by enhancing the prediction models, while the second class of algorithms focuses on improving the features based on which the prediction is made.

In the first class of the algorithms that focus on the prediction models, a variety of tools have been used, including Artificial Neural Networks (ANN), naive Bayes, SVM and random forests. The most popular tool for financial prediction seems to be ANN (Krollner et al., 2010). In (Kara et al., 2011), a comparison between performance of ANN and SVM were done. Ten technical indicators were passed to these two classifiers in order to forecast directional movement of the Istanbul Stock Exchange (ISE) National 100 Index. Authors found that ANNs ability in prediction is significantly better than SVM.

Feedforward ANNs are popular types of ANNs that are capable of predicting both price movement direction and price value. Usually shallow ANNs are trained by back-propagation algorithm (Hecht-Nielsen, 1992; Hagan & Menhaj, 1994). While obstacles like the noisy behavior of stock markets and complexity of feature space make ANNs learning process to converge to suboptimal solutions, sometimes local search algorithms like GA or SA take responsibility of finding initial or final optimal weights for neural networks that are then used for prediction (Kim & Han, 2000; Qiu et al., 2016; Qiu & Song, 2016). In (Qiu et al., 2016), authors used genetic algorithm and simulated annealing to find initial weights of an ANN, and then back-propagation algorithm is used to train the network. This hybrid approach outperformed the standard ANN-based methods in prediction of Nikkei 225 index return. With slight modifications in (Qiu & Song, 2016), genetic algorithm was successfully utilized to find optimized weights of an ANN in which technical indicators were utilized to predict the direction of Nikkei 225 index movement.

Authors of (Zhong & Enke, 2017) have applied PCA and two variations of it in order to extract better features. A collection of different features was used as input data while an ANN was used for prediction of S&P 500. The results showed an improvement of the prediction using the features generated by PCA compared to the other two variations of that. The reported accuracy of predictions varies from 56% to 59% for different number of components used in PCA. Another study on the effect of features on the performance of prediction models has been reported in (Patel et al., 2015). This research uses common tools including ANN, SVM, random forest and naive Bayes for predicting directional movement of famous indices and stocks in Indian stock market. This research showed that mapping the data from a space of ten technical features to another feature space that represents trends of those features can lead to an improvement in the performance of the prediction.

According to mentioned researches and similar works, when a shallow model is used for prediction, the quality of features by which the input data is represented has a critical role in the performance of the prediction. The simplicity of shallow models can avoid them from achieving effective mappings from input space to successful predictions. So, with regards to availability of large amounts of data and emerging effective learning methods for training deep models, researchers have recently turned to such approaches for market prediction. An important aspect of deep models is that they are usually able to extract rich sets of features from the raw data and make predictions based on that. So, from this point of view, deep models usually combine both phases of feature extraction and prediction in a single phase.

Deep ANNs, that are basically neural networks with more than one hidden layers, are among the first deep methods used in the domain. In (Moghaddam et al., 2016), authors predicted NASDAQ prices based on the historical price of four and nine days ago. ANNs with different structures, including both deep and shallow ones, were examined in order to find appropriate number of hidden layers and neurons inside them. The experiments proved the superiority of deep ANNs over shallow ones. In (Ar´evalo et al., 2016), authors used a deep ANN with five hidden layers to forecast Apple Incs stock price during the financial crisis. For each minute of trading three features were extracted from the fluctuation of price inside that time period. Outputs showed up to about 65% directional accuracy. In (Yong et al., 2017), an ANN with three hidden layers was utilized to predict the index price of Singapores stock market. Historical prices of the last ten days were fed to a deep ANN in order to predict the future price of next one to five days. This experiment reported that the highest performance was achieved for one day ahead prediction with MAPE of 0.75.

In (Chong et al., 2017), authors draw an analogy between different data representation methods including RBM, Auto-encoder and PCA applied on raw data with 380 features. The resulting representations were then fed to a deep ANN for prediction. The results showed that none of the data representation methods has superiority over the others in all of the tested experiments.

Recurrent Neural Networks are a kind of neural networks that are specially designed to have internal memory that enables them to extract historical features and make predictions based on them. So, they seem fit for the domains like market prediction in which historical behavior of markets has an important role in prediction. LSTM is one of the most popular kinds of RNNs. In (Nelson et al., 2017), technical indicators were fed to an LSTM in order to predict the direction of stock prices in the Brazilian stock market. According to the reported results, LSTM outperformed MLP, by achieving an accuracy of $5 5 . 9 \%$ .

Convolutional Neural Network is another deep learning algorithm applied in stock market prediction after MLP and LSTM while its ability to extract efficient features has been proven in many other domains as well. In (Di Persio $\&$ Honchar, 2016), CNN, LSTM and MLP were applied to the historical data of close prices of S&P 500 index. Results showed that CNN outperformed LSTM and MLP with accuracy of 53.6% while LSTM and MLP had accuracy of $5 2 . 2 \%$ and $5 2 . 1 \%$ respectively.

Based on some reported experiments, the way the input data is designed to be fed and processed by CNN has an important role in the quality of the extracted feature set and the final prediction. For example, CNN was used in (Gunduz et al., 2017) in which data of 10 days of 100 companies in Borsa Istanbul were utilized to produce technical indicators and time-lagged features. Then, a CNN was applied to improve the feature set. The reported comparison between CNN and logistic regression shows almost no difference between two methods. In another attempt to improve the prediction, features were clustered into different groups and similar features were put beside each other. The experiments showed that this preprocessing step has improved the performance of CNN to achieve F-measure of $5 6 \%$ .

Table 1 summarizes explained papers in terms of initial feature set, feature extraction algorithm and prediction method. As it can be seen there is a tendency toward deep learning models in recent publications, due to the capability of these algorithms in automatic feature extraction from raw data. However, most of the researchers have used only technical indicators or historical price data of one market for prediction while there are various sources of data which could enhance accuracy of prediction of stock market. In this paper, we are going to introduce a novel CNN-based framework that is designed to aggregate several sources of information in order to automatically extract features to predict direction of stock markets.

# 3. Background

Before presenting our suggested approach, in this section, we review the convolutional neural network that is the main element of our framework.

# 3.1. Convolutional Neural Network

LeCun and his colleagues introduced convolutional neural networks in 1995 (LeCun et al., 1995; Gardner & Dorling, 1998). CNN has many layers which could be categorized into input layer, convolutional layers, pooling layers, fully connected layers and output layer.

# 3.1.1. Convolutional layer

The convolutional layer is supposed to do the convolution operation on the data. In fact, input could be considered as a function, filter applied to that is another function and convolution operation is an algorithm used to measure changes caused by applying filter on the input. Size of a filter shows the coverage of that filter. Each filter utilizes a shared set of weights to perform the convolutional operation. Weights are updated during the process of training.

Lets posit input of layer ${ \mathit { l } } - 1$ is an $N \times N$ matrix and $F \times F$ convolutional filters are used. Then, input of layer $\it { \Delta } l$ is calculated according to Eq 1. Fig 1 shows applying filter to the input data in order to get value of $v _ { 1 , 1 }$ in the next layer. Usually, output of each filter is passed through an activation function before entering the next layer. Relu (Eq 2) is a commonly used nonlinear activation function.

Table 1: Summary of explained papers   

<table><tr><td>Author/year</td><td>Target Data</td><td>Feature Set</td><td>Feature Extraction</td><td>Prediction Method</td></tr><tr><td>(Kara et al., 2011)</td><td>Borsa Istanbul BIST 100 Index</td><td>technical indicator</td><td>ANN</td><td>ANN SVM</td></tr><tr><td>(Patel et al., 2015)</td><td>4 Indian stocks &amp; indices</td><td>technical indicator</td><td>ANN</td><td>ANN-SVM RF-NB</td></tr><tr><td>(Qiu et al., 2016)</td><td>Nikkei 225 index</td><td>financial indicator macroeconomic data</td><td>ANN</td><td>GA+ANN SA+ANN</td></tr><tr><td>(Qiu &amp; Song, 2016)</td><td>Nikkei 225 index</td><td>technical indicator</td><td>ANN</td><td>GA+ANN</td></tr><tr><td>(Nelson et al., 2017)</td><td>Brazil Bovespa 5 stocks</td><td>technical indicator</td><td>LSTM</td><td>LSTM</td></tr><tr><td>(Di Persio &amp; Honchar, 2016)</td><td>S&amp;P 500 index</td><td>price data</td><td>MLP-RNN-CNN wavelet+CNN</td><td>MLP RNN CNN</td></tr><tr><td>(Moghaddam et al., 2016)</td><td>NASDAQ</td><td>price data</td><td>ANN-DNN</td><td>ANN-DNN</td></tr><tr><td>(Arévalo et al., 2016)</td><td>AAPL Inc.</td><td>3 extracted features</td><td>DNN</td><td>DNN</td></tr><tr><td>(Zhong &amp; Enke, 2017)</td><td>S&amp;P 500 index</td><td>various sources</td><td>PCA</td><td>ANN</td></tr><tr><td>(Yong et al., 2017)</td><td>Singapore STI</td><td>of data price data</td><td>DNN</td><td>DNN</td></tr><tr><td>(Chong et al., 2017)</td><td>Korea KOSPI 38 stock returns</td><td>price data</td><td>PCA-RBM</td><td>DNN</td></tr><tr><td>(Gunduz et al., 2017)</td><td>Borsa Istanbul BIST 100 stocks</td><td>technical indicator</td><td>AE Clustering</td><td>CNN</td></tr><tr><td>Our method</td><td>U.S. 5 major indices</td><td>temporal feature various sources of data</td><td>CNN 3D representation of data+CNN</td><td>CNN</td></tr></table>

$$
v _ { i , j } ^ { l } = \delta ( \sum _ { k = 0 } ^ { F - 1 } \sum _ { m = 0 } ^ { F - 1 } w _ { k , m } V _ { i + k , j + m } ^ { l - 1 } )
$$

![](images/7dc5aa0658683538b4bd144689a6f5070acb92f4e490be18bcbaeb379bffcd27.jpg)  
Figure 1: Applying filter $( F \times F )$ to the input $\mathrm { d a t a } ( N \times N )$ in order to get value of $\mathcal { V } _ { 1 , 1 }$ in the next layer

In the Eq 1, $v _ { i , j } ^ { l }$ is the value at row $i$ , column $j$ of layer $\it { \Delta } l$ , is the weight $w _ { k , m }$ at row $k$ , column $m$ of filter and $\delta$ is the activation function.

$$
f ( x ) = m a x ( 0 , x )
$$

# 3.1.2. Pooling layer

Pooling layer is responsible for subsampling the data. This operation, not only reduces the computational cost of the learning process, but also it is a way for handling the overfitting problem in CNN. Overfitting is a situation that arises when a trained model makes too fit to the training data, such that it cannot generalize to the future unseen data. It has a connection to the number of parameters that are learned and the amount of data that the prediction model is learned from. Deep models, including CNNs, usually have many parameters so they are prone to overfitting more than shallow models. Some methods have been suggested to avoid overfitting. Using pooling layers in CNNs can help to reduce the risk of overfitting. All the values inside a pooling window are converted to only one value. This transformation reduces the size of the input of the following layers, and hence, reduces the number of the parameters that must be learned by the model, that in turn, lowers the risk of overfitting. Max pooling is the most common type of pooling in which the maximum value in a certain window is chosen.

# 3.1.3. Fully connected layer

At the final layer of a CNN, there is an MLP network which is called its fully connected layer. It is responsible for converting extracted features in the previous layers to the final output. The relation between two successive layers is defined by Eq 3

$$
v _ { i } ^ { j } = \delta ( \sum _ { k } v _ { k } ^ { j - 1 } w _ { k , i } ^ { j - 1 } )
$$

In Eq 3, $v _ { i } ^ { j }$ is the value of neuron $i$ at the layer $j$ , $\delta$ is activation function and weight of connection between neuron $k$ from layer $j - 1$ and neuron $_ i$ from layer $j$ are shown by $w _ { k , i } ^ { j - 1 }$ .

# 3.2. Dropout

In addition to pooling, we have also used another technique called dropout that was first developed for training deep neural networks. The idea behind the dropout technique is to avoid the model from learning too much from the training data. So, in each learning cycle during the training phase, each neuron has a chance equal to some dropout rate, to not be trained in that cycle. This avoids the model from being too flexible, and so, helps the learning algorithm to converge to a model that is not too much fit to the training data, and instead, can be generalized well for prediction the unlabeled future data (Hinton et al., 2012; Srivastava et al., 2014).

# 4. Proposed CNN: CNNpred

CNN has many parameters including the number of layers, number of filters in each layer, dropout rate, size of filters in each layer, initial representation of input data and so on which should be chosen wisely to get the desired outcomes. Although $3 \times 3$ and $5 \times 5$ filters are quite common in image processing domain, we think that size of each filter should be determined according to financial interpretation of features and their characteristics rather than just following previous works in image processing. Here we introduce the architecture of CN-NPred, a general CNN-based framework for stock market prediction. CNNPred has two variations that are referred to as 2D-CNNpred and 3D-CNNpred. We explain the framework in four major steps: representation of input data, daily feature extraction, durational feature extraction and final prediction.

Representation of input data: CNNpred takes information from different markets and uses it to predict the future of those markets. As we mentioned 2D-CNNpred and 3D-CNNpred take different approaches for constructing prediction models. The goal of the first approach is to find a general model for mapping the history of a market to its future fluctuations and by ”general model we mean a model that is valid for several markets. In other words, we assume that the true mapping function from the history to the future is the one that is correct for many markets. For this goal, we need to design a single model that is able to predict the future of a market based on its own history, however, to extract the desired mapping function, that model needs to be trained by samples from different markets. 2D-CNNpred follows this general approach, but in addition to modeling the history of a market as the input data, it also uses a variety of other sources of information as well. In 2D-CNN-pred all this information is aggregated and fed to a specially designed CNN as a two-dimensional tensor, and thats why it is called 2D-CNNpred. On the other hand, the second approach, 3D-CNNpred, assumes that different models are needed for making predictions in different markets, but each prediction model can use information from the history of many markets. In other words, 3D-CNNpred, unlike 2D-CNNpred, does not train a single prediction model that can predict the future of each market given its own historical data, but instead, it extracts features from the historical information of many markets and uses them to train a separate prediction model for each market. The intuition behind this approach is that the mechanisms that dictate the future behavior of each market differs, at least slightly, from other markets. However, what happens in the future in a market, may depend on what happens inside and outside that certain market. Based on this intuition, 3D-CNNpred uses a tensor with three dimensions, to aggregate historical information from various markets and feed it to a specially designed CNN to train a prediction model for each market. Although the structure of the model is the same for all the markets, the data that is used for training is different for each market. In other words, in 3D-CNNpred, each prediction model can see all the available information as input, but is trained to predict the future of a certain market based on that input. One can expect that 3D-CNNpred, unlike 2D-CNNpred, will be able to combine information from different markets into high-level features before making predictions. Fig 2 shows a schema of how data is represented and used in CNNpreds variations.

Daily feature extraction: Each day in the historical data is represented by a series of features like opening and closing prices. The traditional approach to market prediction is to analyze these features for example in the form of candlesticks, probably by constructing higher level features based on them, in order to predict the future behavior of the market. The idea behind the design of first layer of CNNpred comes from this observation. In the first step of both variations of CNNpred, there is a convolutional layer whose task is to combine the daily features into higher level features for representing each single day of the history.

![](images/3c3c363df3de5c757257e5ff6f0125b16853d8287d33d4586bb0629d3eac0e3b.jpg)  
3D-CNNpred   
Figure 2: The structure of input data in two variations of CNNpred

Durational feature extraction: Some other useful information for predicting the future behavior of a market comes from studying the behavior of the market over time. Such a study can give us information about the trends that appear in the markets behavior, and find patterns that can predict the future based on them. So it is important to combine features of consecutive days of data to gather high-level features representing trends or reflecting the markets behavior in certain time intervals. Both 2D-CNNpred and 3D-CNNpred data have layers that are supposed to combine extracted features in the first layer and produce even more sophisticated features summarizing the data in some certain time interval.

Final prediction: At the final step, the features that are generated in previous layers are converted to a one-dimensional vector using a flattening operation and this vector is fed to a fully connected layer that maps the features to a prediction.

In the next two sections, we will explain the general design of 2D-CNNpred and 3D-CNNpred as well as how they have been adopted for the data set that we have used in the specific experiments performed in this paper. In our experiments, we have used data from 5 different indices. Each index has 82 features that means each day of the history of a market is represented by 82 features. The 82 gathered features are selected in a way that form a complete feature set and consist of economic data, technical indicators, big U.S. companies, commodities, exchange rate of currencies, future contracts and worlds stock indices. The length of the history is 60 days that is for each prediction, the model can use information from 60 last days.

# 4.1. 2D-CNNpred

Representation of input data: As we mentioned before, the input to the 2D-CNNpred is a two-dimensional matrix. The size of the matrix depends on the number of features that represent each day, as well as the number of days back into the history, that is used for making a prediction. If the input used for prediction consists of $d$ days each represented by $f$ features then the size of input tensor will be $d \times f$ .

Daily feature extraction: To extract daily features in 2D-CNNpred, 1 $\times$ number of initial features filters are utilized. Each of those filters covers all the daily features and can combine them into a single higher level feature, so using this layer, 2D-CNNpred can construct different combinations of primary features. It is also possible for the network to drop useless features by setting their corresponding weights in filters equal to zero. So this layer works as an initial feature extraction/feature selection module. Fig 3 represents application of a simple filter on the input data.

Durational feature extraction: While the first layer of 2D-CNNpred extracts features out of primary daily features, the following layers combine extracted features of different days to construct higher level features for aggregating the available information in certain durations. Like the first layer, these succeeding layers use filters for combining lower level features from their input to higher level ones. 2D-CNNpred uses 3 $\times$ 1 filters in the second layer. Each of those filters covers three consecutive days, a setting that is inspired by the observation that most of the famous candlestick patterns like Three Line Strike and Three Black Crows, try to find meaningful patterns in three consecutive days (Nison, 1994; Bulkowski, 2012; Achelis, 2001). We take this as a sign of the potentially useful information that can be extracted from a time window of three consecutive times unites in the historical data. The third layer is a pooling layer that performs a $2 \times 1$ max pooling, that is a very common setting for the pooling layers. After this pooling layer and in order to aggregate the information in longer time intervals and construct even more complex features, 2D-CNNpred uses another convolutional layer with $3 \times 1$ filters followed by a second pooling layer just like

![](images/290450b9105957578a78e88247cf572bb8e299fdbc0e99edddf7de2408b16431.jpg)  
Figure 3: Applying a $1 \times$ number of features filter to 2D input tensor.

the first one.

Final prediction: Produced features generated by the last pooling layer are flattened into a final feature vector. This feature vector is then converted to a final prediction through a fully connected layer. Sigmoid (Eq 4) is the activation function that we choose for this layer. Since the output of sigmoid is a number in [0-1] interval, the prediction that is made by 2D-CNNpred for a market can be interpreted as the probability of an increase in the price of that market for the next day, that is a valuable piece of information. Clearly, it is rational to put more money on a stock that has a higher probability of going up. On the other hand, stocks with a low probability of going up are good candidates for short selling. However, in our experiments, we discretize the output to either $0$ or 1, whichever is closer to the prediction.

$$
f ( x ) = { \frac { 1 } { 1 + \exp ( x ) } }
$$

A sample configuration of 2D-CNNpred: As we mentioned before the input we used for each prediction consists of 60 days each represented by 82 features. So, the input to the 2D-CNNpred is a matrix of 60 by 82. The first convolutional layer uses eight $1 \times 8 2$ filters after which there are two convolutional layers with eight $3 \times 1$ filters, each followed by a layer of $2 \times 1$ max-pooling. The final flattened feature vector contains 104 features that are fed to the fully connected layer to produce the final output. Fig 4 shows a graphical visualization of described process.

# 4.2. 3D-CNNpred

Representation of input data: 3D-CNNpred, unlike 2D-CNNpred, uses a three-dimensional tensor to represent data. The reason is that each sample that is fed to 3D-CNNpred, contains information from several markets. So, the initial daily features, the days of the historical record and the markets from which the data is gathered form the three dimensions of the input tensor. Suppose our dataset consists $_ i$ different markets, $k$ features for each of these markets and our goal is to predict day $t$ based on past $j$ days. Fig 5 shows how one sample of the data would be represented.

![](images/1a9c736d8ca987021e17b1a854952698a12fbd937ab1e4362f601c738db8f623.jpg)  
Figure 4: Graphical Visualization of 2D-CNNpred

![](images/ccd5f1455af6e9f90112a2b619aec43c81bce275156b2704263c1eafcde23272.jpg)  
Figure 5: Representation of input data in 3D-CNNpred based on $k$ primary features, $i$ related markets and $j$ days before the day of prediction

Daily feature extraction: The first layer of filters in 3D-CNNpred is defined as a set of $1 \times 1$ convolutional filters, while the primary features are represented along the depth of the tensor. Fig 6 shows how a $1 \times 1$ filter works. This layer of filters is responsible for combining subsets of basic features that are available through the depth of the input tensor into a set of higher level features. The input tensor is transformed by this layer into another tensor whose width and height is the same but its depth is equal to the number of $1 \times 1$ convolutional filters of layer one. Same as 2D-CNNpred, the network has the capability to act as a feature selection/extraction algorithm.

![](images/33a16c7a361611e8d2ec319f3f195350e003c90eb9fcea1f170cd07030165f4e.jpg)  
Figure 6: Applying a $1 \times 1$ filter to the first part of the 3D input tensor.

Durational feature extraction: In addition to daily features, 3D-CNNpreds input data provides information about other markets. Like 2D-CNNpred, the next four layers are dedicated to extracting higher level features that summarize the fluctuation patterns of the data in time. However, in 3D-CNNpred, this is done over a series of markets instead of one. So, the width of the filters in the second convolutional layer is defined in a way that covers all the pertinent markets. Same as 2D-CNNpred and motivated by the same mentioned reason, the height of filters is selected to be 3 so as to cover three consecutive time units. Using this setting, the size of filters in the second convolutional layer is 3 $\times$ number of markets. The next three layers, like those of 2D-CNNpred, are defined as a $2 \times 1$ max pooling layer, another $3 \times 1$ convolutional layer followed by a final $2 \times 1$ max pooling layer.

Final prediction: Same as 2D-CNNpred, here in 3D-CNNpred the output of the durational feature extraction phase is flattened and used to produce the final results.

A sample configuration of 3D-CNNpred: In our experiments, the input to the 3D-CNNpred is a matrix of 60 by 5 with depth of 82. The first convolutional layer uses eight filters to perform $1 \times 1$ convolutional operation, after which there is one convolutional layer with eight $3 \times 5$ filters followed by $2 \times 1$ max pooling layer. Then, another convolutional layer utilizes eight $3 \times 1$ filters, again followed by a $2 \times 1$ max-pooling layer generate the final 104 features. In the end, a fully connected layer converts 104 neurons to 1 neuron and produces the final output. Fig 7 shows a graphical visualization of the process.

![](images/e715c2faece332e0dc62d86491cb33657ec3e41b17160a56439a6ea65062dd14.jpg)  
Figure 7: Graphical Visualization of 3D-CNNpred

# 5. Initial feature set for each market

As we mentioned before, our goal is to develop a model for prediction of the direction of movements of stock market prices or indices. We applied our approach to predict the movement of indices of S&P 500, NASDAQ, Dow Jones Industrial Average, NYSE and RUSSELL market. For this prediction task, we use 82 features for representing each day of each market. Some of these features are market-specific while the rest are general economic features and are replicated for every market in the data set. This rich set of features could be categorized in eight different groups that are primitive features, technical indicators, economic data, world stock market indices, the exchange rate of U.S. dollar to the other currencies, commodities, data from big companies of U.S. market and future contracts. We briefly explain different groups of our feature set here and more details about them can be found in Appendix I.

• Primitive features: Close price and which day of week prediction is supposed to happen are primitive features used in this work. • Technical indicators: Technical analysts use technical indicators which come out of historical data of stocks like price, volume and so on to analyze short-term movement of prices. They are quite common in stock market research. The moving averages are examples of this type of features. • Economic data: Economic data reflects whether the economy of a country is doing well or not. In addition to the other effective factors, investors usually take a look at these indicators so as to gain insight into future of stock market. Information coming from Treasury bill belongs to this category. • World stock markets: Usually, stock markets all over the world have interaction with each other because of the phenomenon of globalization of economy. This connection would be more appreciated when we consider time difference in various countries which makes it possible to gain information about future of a country's market by monitoring other countries markets. For instance, effect of other countries stock market like China, Japan and South Korea on U.S. market.

• The exchange rate of U.S. dollar: There are companies that import their needs from other countries or export their product to other countries. In these cases, value of U.S. dollar to other currencies like Canadian dollar and European Euro make an important role in the fluctuation of stock prices and by extent, the whole market.

• Commodities: Another source of information that affects stock market is price of commodities like gold, silver, oil and so on. This kind of information can reflect a view of the global market. This means that the information about the prices of commodities can be useful in prediction of the fluctuations of stock prices.

• Big U.S. Companies: Stock market indices are calculated based on different stocks. Each stock carries a weight in this calculation that matches its share in the market. In another word, big companies are more important than small ones in prediction of stock market indices. Examples of that could be Exxon Mobil Corporation and Apple Inc.

• Futures contracts: Futures contracts are contracts in which one side of agreement is supposed to deliver stock, commodities and so on in the future. These contracts show expected value of the merchandise in the future. Investors tend to buy stocks that have higher expected value than their current value. For instance, S&P 500 Futures, DJI Futures and NASDAQ Futures prices could affect current price of S&P 500 and other indices.

# 6. Experimental settings and results

In this section, we describe the settings that are used to evaluate the models, including datasets, parameters of the networks, evaluation methodology and baseline algorithms. Then, the evaluation results are reported.

Table 2: Description of used indices   

<table><tr><td>Name</td><td>Description</td></tr><tr><td>S&amp;P 500</td><td>Index of 505 companies exist in S&amp;P stock market</td></tr><tr><td>Dow Jones Industrial Average</td><td>Index of 30 major U.S. companies</td></tr><tr><td>NASDAQ Composite</td><td>Index of common companies exist in NASDAQ stock market</td></tr><tr><td>NYSE Composite</td><td>Index of common companies exist in New York Stock Exchange</td></tr><tr><td>RUSSEL 2000</td><td>Index of 2000 small companies in U.S.</td></tr></table>

# 6.1. Data gathering and preparation

The datasets used in this work include daily direction of close of S&P 500 index, NASDAQ Composite, Dow Jones Industrial Average, NYSE Composite and RUSSELL 2000. Table 2 shows more information about them. Each sample has 82 features that already have been explained and its assigned label is determined according to the Eq 5. It is worth mentioning that for each index only technical indicators and primitive features are unique and the other features, like big U.S. companies or price of commodities, are common between different indices.

$$
t a r g e t = \left\{ \begin{array} { l l } { 1 } & { C l o s e _ { t + 1 } > C l o s e _ { t } } \\ { 0 } & { \mathrm { e l s e } } \end{array} \right.
$$

Where $C l o s e _ { t }$ refers to the closing price at day t.

This data are from the period of Jan 2010 to Nov 2017. The first $6 0 \%$ of the data is used for training the models, the next $2 0 \%$ forms the validation data and the last $2 0 \%$ is the test data.

Different features could have various ranges. It is usually confusing for learning algorithms to handle features with different ranges. Generally, the goal of data normalization here is to map the values of all features to a single common range, and it usually improves the performance of the prediction model. We use Eq 6 for normalizing the input data, where $x _ { n e w }$ is normalized feature vector, $x _ { o l d }$ is the original feature vector, $x$ and $\sigma$ are the mean and the standard

Table 3: Parameters of CNN   

<table><tr><td>Parameter</td><td>Value</td></tr><tr><td>Filter size</td><td>{8, 8, 8}</td></tr><tr><td>Activation function</td><td>RELU-Sigmoid</td></tr><tr><td>Optimizer</td><td>Adam</td></tr><tr><td>Dropout rate</td><td>0.1</td></tr><tr><td>Batch size</td><td>128</td></tr></table>

deviation of original feature.

$$
x _ { n e w } = \frac { x _ { o l d } - \bar { x } } { \sigma }
$$

# 6.2. Evaluation methodology

Evaluation metrics are needed to compare results of our method with the other methods. Accuracy is one of the common metrics have been used in this area. However, in an imbalanced dataset, it may be biased toward the models that tend to predict the more frequent class. To address this issue, we report the Macro-Averaged-F-Measure that is the mean of F-measures calculated for each of the two classes (Gunduz et al., 2017; Ozg¨ur et al., 2005). ¨

# 6.3. Parameters of network

Numerous deep learning packages and software have been developed. In this work, Keras (Chollet et al., 2015) was utilized to implement CNN. The activation function of all the layers except the last one is RELU. Complete descriptions of parameters of CNN are listed in Table 3.

# 6.4. Baseline algorithms

We compare the performance of the suggested methods with that of the algorithms applied in the following researches. In all the base-line algorithms the same settings reported in the original paper were used.

Table 4: Technical Indicators   

<table><tr><td>Indicator</td><td>Description</td></tr><tr><td>MA</td><td>Simple Moving Average</td></tr><tr><td>EMA</td><td>Exponential Moving Average</td></tr><tr><td>MOM</td><td>Momentum</td></tr><tr><td>%K</td><td>Stochastic %K</td></tr><tr><td>%D</td><td>Stochastic %D</td></tr><tr><td>RSI</td><td>Relative Strength Index</td></tr><tr><td>MACD</td><td>Moving Average Convergence Divergence</td></tr><tr><td>%R</td><td>Larry Williams %R</td></tr><tr><td>A\D</td><td>(Accumulation\Distribution) Oscillator</td></tr><tr><td>CCI</td><td>Commodity Channel Index</td></tr></table>

• The first baseline algorithm is the one reported in (Zhong & Enke, 2017). In this algorithm, the initial data is mapped to a new feature space using PCA and then the resulting representation of the data is used for training a shallow ANN for making predictions.

• The second baseline is based on the method suggested in (Kara et al., 2011), in which the technical indicators reported in Table 4 are used to train a shallow ANN for prediction.

• The third baseline algorithm is a CNN with two-dimensional input (Gunduz et al., 2017). First, the features are clustered and reordered accordingly. The resulting representation of the data is then used by a CNN with a certain structure for prediction.

# 6.5. Results

In this section, results of five different experiments are explained. Since one of the baseline algorithms uses PCA for dimension reduction, the performance of the algorithm with different number of principal components is tested. In order to make the situation equal for the other baseline algorithms, these algorithms are tested several times with the same condition. Then, average F-measure of the algorithms are compared. More details about used notations are in Table 5.

Table 5: Description of used algorithms   

<table><tr><td>Algorithm</td><td>Explanation</td></tr><tr><td>3D-CNNpred</td><td>Our method</td></tr><tr><td>2D-CNNpred</td><td>Our method</td></tr><tr><td>PCA+ANN (Zhong &amp; Enke, 2017)</td><td>PCA as dimension reduction and ANN as classifier</td></tr><tr><td>Technical (Kara et al., 2011)</td><td>Technical indicators and ANN as classifier</td></tr><tr><td>CNN-cor (Gunduz et al., 2017)</td><td>A CNN with mentioned structure in the paper</td></tr></table>

Tables [6-10] summarize the results for the baseline algorithms as well as our suggested models on S&P 500 index, Dow Jones Industrial Average, NASDAQ Composite, NYSE Composite and RUSSELL 2000 historical data. Each table consists of different statistical information about a specific market. The results include average of F-measure, as well as the best F-measure and the standard deviation of F-measures for the predictions in different runs. Standard deviation of produced F-measures demonstrates how much generated results of a model vacillates over their mean. Models with lower standard deviation are more robust. Also P-values against 2D-CNNpred and 3D-CNNpred are also reported to show whether the differences are significant or not.

To summarize and compare the performance of different algorithms, average results of them in 5 market indices are shown in Fig 8.

# 7. Discussion

It is obvious from the results that both 2D-CNNpred and 3D-CNNpred statistically outperformed the other baseline algorithms. The difference between F-measure of our model and baseline algorithm which uses only ten technical indicators is obvious. A plausible reason for that could be related to the insufficiency of technical indicators for prediction as well as using a shallow ANN instead of our deep prediction model. Even, more initial features and incorporation of PCA which is a famous feature extraction algorithm did not improve the results as it was expected. A drawback of these two approaches may be the fact that they use shallow ANN that has only one hidden layer and its ability in feature extraction is limited. It demonstrates that adding more basic features is not enough by itself without improving the feature extraction algorithm. Our framework has two advantages over these two baseline algorithm that have led to its superiority in performance: First, it uses a rich set of feature containing useful information for stock prediction. Second, it uses a deep learning algorithm that extracts sophisticated features out of primary ones.

Table 6: Statistical information of S&P 500 index using different algorithms   

<table><tr><td>Measure \Model</td><td>Technical</td><td>CNN-cor</td><td>PCA+ANN</td><td>2D-CNNpred</td><td>3D-CNNpred</td></tr><tr><td>Mean of F-measure</td><td>0.4469</td><td>0.3928</td><td>0.4237</td><td>0.4799</td><td>0.4837</td></tr><tr><td>Best of F-measure</td><td>0.5627</td><td>0.5723</td><td>0.5165</td><td>0.5504</td><td>0.5532</td></tr><tr><td>Standard deviation of F-measure</td><td>0.0658</td><td>0.1017</td><td>0.0596</td><td>0.0273</td><td>0.0343</td></tr><tr><td>P-value against 2D-CNNpred</td><td>0.0056</td><td>less than 0.0001</td><td>less than 0.0001</td><td>1</td><td>0.5903</td></tr><tr><td>P-value against 3D-CNNpred</td><td>0.003</td><td>less than 0.0001</td><td>less than 0.0001</td><td>0.5903</td><td>1</td></tr></table>

Table 7: Statistical information of Dow Jones Industrial Average index using different algorithms   

<table><tr><td>Measure \Model</td><td>Technical</td><td>CNN-cor</td><td>PCA+ANN</td><td>2D-CNNpred</td><td>3D-CNNpred</td></tr><tr><td>Mean of F-measure</td><td>0.415</td><td>0.39</td><td>0.4283</td><td>0.4822</td><td>0.4925</td></tr><tr><td>Best of F-measure</td><td>0.5518</td><td>0.5253</td><td>0.5392</td><td>0.5678</td><td>0.5778</td></tr><tr><td>Standard deviation of F-measure</td><td>0.0625</td><td>0.0939</td><td>0.064</td><td>0.0321</td><td>0.0347</td></tr><tr><td>P-value against 2D-CNNpred</td><td>less than 0.0001</td><td>less than 0.0001</td><td>less than 0.0001</td><td>1</td><td>0.1794</td></tr><tr><td>P-value against 3D-CNNpred</td><td>less than 0.0001</td><td>less than 0.0001</td><td>less than 0.0001</td><td>0.1794</td><td>1</td></tr></table>

Table 8: Statistical information of NASDAQ Composite index using different algorithms   

<table><tr><td>Measure \Model</td><td>Technical</td><td>CNN-cor</td><td>PCA+ANN</td><td>2D-CNNpred</td><td>3D-CNNpred</td></tr><tr><td>Mean of F-measure</td><td>0.4199</td><td>0.3796</td><td>0.4136</td><td>0.4779</td><td>0.4931</td></tr><tr><td>Best of F-measure</td><td>0.5487</td><td>0.5498</td><td>0.5312</td><td>0.5219</td><td>0.5576</td></tr><tr><td>Standard deviation of F-measure</td><td>0.0719</td><td>0.1114</td><td>0.0553</td><td>0.0255</td><td>0.0405</td></tr><tr><td>P-value against 2D-CNNpred</td><td>less than 0.0001</td><td>less than 0.0001</td><td>less than 0.0001</td><td>1</td><td>0.0509</td></tr><tr><td>P-value against 3D-CNNpred</td><td>less than 0.0001</td><td>less than 0.0001</td><td>less than 0.0001</td><td>0.0509</td><td>1</td></tr></table>

Table 9: Statistical information of NYSE Composite using different algorithms   

<table><tr><td>Measure \Model</td><td>Technical</td><td>CNN-cor</td><td>PCA+ANN</td><td>2D-CNNpred</td><td>3D-CNNpred</td></tr><tr><td>Mean of F-measure</td><td>0.4071</td><td>0.3906</td><td>0.426</td><td>0.4757</td><td>0.4751</td></tr><tr><td>Best of F-measure</td><td>0.5251</td><td>0.5376</td><td>0.5306</td><td>0.5316</td><td>0.5592</td></tr><tr><td>Standard deviation of F-measure</td><td>0.0556</td><td>0.0926</td><td>0.059</td><td>0.0314</td><td>0.0384</td></tr><tr><td>P-value against 2D-CNNpred</td><td>less than 0.0001</td><td>less than 0.0001</td><td>less than 0.0001</td><td>1</td><td>0.9366</td></tr><tr><td>P-value against 3D-CNNpred</td><td>less than 0.0001</td><td>less than 0.0001</td><td>less than 0.0001</td><td>0.9366</td><td>1</td></tr></table>

Table 10: Statistical information of RUSSELL 2000 using different algorithms   

<table><tr><td>Measure \Model</td><td>Technical</td><td>CNN-cor</td><td>PCA+ANN</td><td>2D-CNNpred</td><td>3D-CNNpred</td></tr><tr><td>Mean of F-measure</td><td>0.4525</td><td>0.3924</td><td>0.4279</td><td>0.4775</td><td>0.4846</td></tr><tr><td>Best of F-measure</td><td>0.5665</td><td>0.5602</td><td>0.5438</td><td>0.532</td><td>0.5787</td></tr><tr><td>Standard deviation of F-measure</td><td>0.0655</td><td>0.0977</td><td>0.066</td><td>0.0271</td><td>0.0371</td></tr><tr><td>P-value against 2D-CNNpred</td><td>0.0327</td><td>less than 0.0001</td><td>0.0001</td><td>1</td><td>0.3364</td></tr><tr><td>P-value against 3D-CNNpred</td><td>0.01</td><td>less than 0.0001</td><td>less than 0.0001</td><td>0.3364</td><td>1</td></tr></table>

![](images/bfaf4f4b13b6ede93c2a542f11ed1cb0ce4fda55bb38f14a4a002e4d80d062e3.jpg)  
Figure 8: Mean F-measure of different algorithms in different markets

The next baseline algorithm was CNN-Cor which had the worst results among all the tested algorithms. CNNs ability in feature extraction is highly dependent on wisely selection of its parameters in a way that fits the problem for which it is supposed to be applied. With regards to the fact that both 2D-CNNpred and CNN-Cor used the same feature set and they were trained almost in the same way, poor results of CNN-Cor compared to 2D-CNNpred is possibly the result of the design of the 2D-CNN. Generally, the idea of using $3 \times 3$ and $5 \times 5$ filters seems skeptical. The fact that these kinds of filters are popular in computer vision does not guarantee that they would work well in stock market prediction as well. In fact, prediction with about 9% lower F-measure on average in comparison to the 2D-CNNpred showed that designing the structure of CNN is the core challenge in applying CNNs for stock market prediction. A poorly designed CNN can adversely influence the results and make CNNs performance even worse than a shallow ANN.

Finally, an advantage of 3D-CNNpred over 2D-CNNpred which could be the reason for slightly better performance of 3D-CNN is that the latter one can combine information from different markets into a high-level feature while 2D-CNNpred has access to one markets initial features in its feature extraction phase.

# 8. Conclusion

The noisy and nonlinear behavior of prices in financial markets makes prediction in those markets a difficult task. A better prediction can be gained by having better features. In this paper, we tried to use a wide collection of information, including historical data from the target market, general economic data and information from other possibly correlated stock markets. Also, two variations of a deep CNN-based framework were introduced and applied to extract higher-level features from that rich set of initial features.

The suggested framework, CNNpred, was tested to make predictions in S&P 500, NASDAQ, DJI, NYSE, and RUSSELL. Final results showed the significant superiority of two versions of CNNPred over the state of the art baseline algorithms. CNNpred was able to improve the performance of prediction in all the five indices over the baseline algorithms by about 3% to $1 1 \%$ , in terms of F-measure. In addition to confirming the usefulness of the suggested approach, these observations also suggest that designing the structures of CNNs for the stock prediction problems is possibly a core challenge that deserves to be further studied.

# Appendix I. Description of features

The list of features from different categories used as initial feature set representing each sample:

<table><tr><td>#</td><td>Feature</td><td>Description</td><td>Type</td><td>Source / Calculation</td></tr><tr><td>1</td><td>Day</td><td>which day of week</td><td>Primitive</td><td>Pandas</td></tr><tr><td>2</td><td>Close</td><td>Close price</td><td>Primitive</td><td>Yahoo Finance</td></tr><tr><td>3</td><td>Vol</td><td>Relative change of volume</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>4</td><td>MOM-1</td><td>Return of 2 days before</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>5</td><td>MOM-2</td><td>Return of 3 days before</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>6</td><td>MOM-3</td><td>Return of 4 days before</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>7</td><td>ROC-5</td><td>5 days Rate of Change</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>8</td><td>ROC-10</td><td>10 days Rate of Change</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>9</td><td>ROC-15</td><td>15 days Rate of Change</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>10</td><td>ROC-20</td><td>20 days Rate of Change</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>11</td><td>EMA-10</td><td>10 days Exponential Moving Average</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>12</td><td>EMA-20</td><td>20 days Exponential Moving Average</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>13</td><td>EMA-50</td><td>50 days Exponential Moving Average</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>14</td><td>EMA-200</td><td>200 days Exponential Moving Average</td><td>Technical Indicator</td><td>TA-Lib</td></tr><tr><td>15</td><td>DTB4WK</td><td>4-Week Treasury Bill: Secondary Market Rate</td><td>Economic</td><td>FRBSL</td></tr><tr><td>16</td><td>DTB3</td><td>3-Month Treasury Bill: Secondary Market Rate</td><td>Economic</td><td>FRBSL</td></tr><tr><td>17</td><td>DTB6</td><td>6-Month Treasury Bill: Secondary Market Rate</td><td>Economic</td><td>FRBSL</td></tr><tr><td>18</td><td>DGS5</td><td>5-Year Treasury Constant Maturity Rate</td><td>Economic</td><td>FRBSL</td></tr><tr><td>19</td><td>DGS10</td><td>10-Year Treasury Constant Maturity Rate</td><td>Economic</td><td>FRBSL</td></tr><tr><td>20</td><td>DAAA</td><td>Moody's Seasoned Aaa Corporate Bond Yield</td><td>Economic</td><td>FRBSL</td></tr><tr><td>21</td><td>DBAA</td><td>Moody's Seasoned Baa Corporate Bond Yield</td><td>Economic</td><td>FRBSL</td></tr><tr><td>22</td><td>TE1</td><td>DGS10-DTB4WK</td><td>Economic</td><td>FRBSL</td></tr><tr><td>23</td><td>TE2</td><td>DGS10-DTB3</td><td>Economic</td><td>FRBSL</td></tr><tr><td>24</td><td>TE3</td><td>DGS10-DTB6</td><td>Economic</td><td>FRBSL</td></tr><tr><td>25</td><td>TE5</td><td>DTB3-DTB4WK</td><td>Economic</td><td>FRBSL</td></tr><tr><td>26</td><td>TE6</td><td>DTB6-DTB4WK</td><td>Economic</td><td>FRBSL</td></tr><tr><td>27</td><td>DE1</td><td>DBAA-BAAA</td><td>Economic</td><td>FRBSL</td></tr><tr><td>28</td><td>DE2</td><td>DBAA-DGS10</td><td>Economic</td><td>FRBSL</td></tr><tr><td>29</td><td>DE4</td><td>DBAA-DTB6</td><td>Economic</td><td>FRBSL</td></tr><tr><td>30</td><td>DE5</td><td>DBAA-DTB3</td><td>Economic</td><td>FRBSL</td></tr><tr><td>31</td><td>DE6</td><td>DBAA-DTB4WK</td><td>Economic</td><td>FRBSL</td></tr><tr><td>32</td><td>CTB3M</td><td>Change in the market yield on U.S. Treasury securities at 3-month constant maturity, quoted on investment basis</td><td>Economic</td><td>FRBSL</td></tr><tr><td>33</td><td>CTB6M</td><td>Change in the market yield on U.S. Treasury securities at</td><td>Economic</td><td>FRBSL</td></tr><tr><td>34</td><td></td><td>6-month constant maturity, quoted on investment basis Change in the market yield on U.S. Treasury securities at</td><td></td><td></td></tr><tr><td></td><td>CTB1Y</td><td>1-year constant maturity, quoted on investment basis</td><td>Economic</td><td>FRBSL</td></tr><tr><td>35 36</td><td>Oil</td><td>Relative change of oil price(WTI), Oklahoma</td><td>Commodity</td><td>FRBSL</td></tr><tr><td>37</td><td>Oil</td><td>Relative change of oil price(Brent)</td><td>Commodity</td><td>Investing.com</td></tr><tr><td>38</td><td>Oil</td><td>Relative change of oil price(WTI)</td><td>Commodity Commodity</td><td>Investing.com</td></tr><tr><td></td><td>Gold</td><td>Relative change of gold price (London market)</td><td></td><td>FRBSL</td></tr><tr><td>39</td><td>Gold-F</td><td>Relative change of gold price futures</td><td>Commodity</td><td>Investing.com</td></tr><tr><td>40</td><td>XAU-USD</td><td>Relative change of gold spot U.S. dollar</td><td>Commodity</td><td>Investing.com</td></tr><tr><td>41</td><td>XAG-USD</td><td>Relative change of silver spot U.S. dollar</td><td>Commodity</td><td>Investing.com</td></tr><tr><td>42</td><td>Gas</td><td>Relative change of gas price</td><td>Commodity</td><td>Investing.com</td></tr><tr><td>43</td><td>Silver</td><td>Relative change of silver price</td><td>Commodity</td><td>Investing.com</td></tr><tr><td>44</td><td>Copper</td><td>Relative change of copper future</td><td>Commodity</td><td>Investing.com</td></tr><tr><td>45</td><td>IXIC</td><td>Return of NASDAQ Composite index</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>46</td><td>GSPC</td><td>Return of S&amp;P 500 index</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>47</td><td>DJI</td><td>Return of Dow Jones Industrial Average</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>48</td><td>NYSE</td><td>Return of NY stock exchange index</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>49</td><td>RUSSELL</td><td>Return of RUSSELL 2000 index</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>50</td><td>HSI</td><td>Return of Hang Seng index</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>51</td><td>SSE</td><td>Return of Shang Hai Stock Exchange Composite index</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>52</td><td>FCHI</td><td>Return of CAC 40</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>53</td><td>FTSE</td><td>Return of FTSE 100</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>54</td><td>GDAXI</td><td>Return of DAX</td><td>World Indices</td><td>Yahoo Finance</td></tr><tr><td>55</td><td>USD-Y</td><td>Relative change in US dollar to Japanese yen exchange rate</td><td>Exchange Rate</td><td>Yahoo Finance</td></tr><tr><td>56</td><td>USD-GBP</td><td>Relative change in US dollar to British pound exchange rate</td><td>Exchange Rate</td><td>Yahoo Finance</td></tr><tr><td>57</td><td>USD-CAD</td><td>Relative change in US dollar to Canadian dollar exchange rate</td><td>Exchange Rate</td><td>Yahoo Finance</td></tr><tr><td>58</td><td>USD-CNY</td><td>Relative change in US dollar to Chinese yuan exchange rate</td><td>Exchange Rate</td><td>Yahoo Finance</td></tr><tr><td>59</td><td>USD-AUD</td><td>Relative change in US dollar to Australian dollar exchange rate</td><td>Exchange Rate</td><td>Investing.com</td></tr><tr><td>60</td><td>USD-NZD</td><td>Relative change in US dollar to New Zealand dollar exchange rate</td><td>Exchange Rate</td><td>Investing.com</td></tr><tr><td>61</td><td>USD-CHF</td><td>Relative change in US dollar to Swiss franc exchange rate</td><td>Exchange Rate</td><td>Investing.com</td></tr><tr><td>62</td><td>USD-EUR</td><td>Relative change in US dollar to Euro exchange rate</td><td>Exchange Rate</td><td>Investing.com</td></tr><tr><td>63</td><td>USDX</td><td>Relative change in US dollar index</td><td>Exchange Rate</td><td>Investing.com</td></tr><tr><td>64</td><td>XOM</td><td>Return of Exon Mobil Corporation</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>65</td><td>JPM</td><td>Return of JPMorgan Chase &amp; Co.</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>66</td><td>AAPL</td><td>Return of Apple Inc.</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>67</td><td>MSFT</td><td>Return of Microsoft Corporation</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>68</td><td>GE</td><td>Return of General Electric Company</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>69</td><td>JNJ</td><td>Return of Johnson &amp; Johnson</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>70</td><td>WFC</td><td>Return of Wells Fargo &amp; Company</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>71</td><td>AMZN</td><td>Return of Amazon.com Inc.</td><td>U.S. Companies</td><td>Yahoo Finance</td></tr><tr><td>72</td><td>FCHI-F</td><td>Return of CAC 40 Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>73</td><td>FTSE-F</td><td>Return of FTSE 100 Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>74</td><td>GDAXI-F</td><td>Return of DAX Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>75</td><td>HSI-F</td><td>Return of Hang Seng index Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>76</td><td>Nikkei-F</td><td>Return of Nikkei index Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>77</td><td>KOSPI-F</td><td>Return of Korean stock exchange Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>78</td><td>IXIC-F</td><td>Return of NASDAQ Composite index Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>79</td><td>DJI-F</td><td>Return of Dow Jones Industrial Average Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>80</td><td>S&amp;P-F</td><td>Return of S&amp;P 500 index Futures</td><td>Futures</td><td>Investing.com</td></tr><tr><td>81</td><td>RUSSELL-F</td><td>Return of RUSSELL Futures</td><td>Futures</td><td></td></tr><tr><td>82</td><td>USDX-F</td><td>Relative change in US dollar index futures</td><td>Exchange Rate</td><td>Investing.com Investing.com</td></tr><tr><td colspan="5"></td></tr></table>

# References

# References

Achelis, S. B. (2001). Technical Analysis from A to $Z$ . McGraw Hill New York.

Ar´evalo, A., Ni˜no, J., Hern´andez, G., & Sandoval, J. (2016). High-frequency trading strategy based on deep neural networks. In International conference on intelligent computing (pp. 424–436). Springer.

Atsalakis, G. S., & Valavanis, K. P. (2009). Surveying stock market forecasting techniques–part ii: Soft computing methods. Expert Systems with Applications, 36 , 5932–5941.

Ballings, M., Van den Poel, D., Hespeels, N., & Gryp, R. (2015). Evaluating multiple classifiers for stock price direction prediction. Expert Systems with Applications, 42 , 7046–7056.

Bao, W., Yue, J., & Rao, Y. (2017). A deep learning framework for financial time series using stacked autoencoders and long-short term memory. PloS one, 12 , e0180944.   
Brown, M. S., Pelosi, M. J., & Dirska, H. (2013). Dynamic-radius species-conserving genetic algorithm for the financial forecasting of dow jones index stocks. In International Workshop on Machine Learning and Data Mining in Pattern Recognition (pp. 27–41). Springer.   
Bulkowski, T. N. (2012). Encyclopedia of candlestick charts volume 332. John Wiley & Sons.   
Cai, X., Hu, S., & Lin, X. (2012). Feature extraction using restricted boltzmann machine for stock price prediction. In Computer Science and Automation Engineering (CSAE), 2012 IEEE International Conference on (pp. 80–83). IEEE volume 3.   
Chen, K., Zhou, Y., & Dai, F. (2015). A lstm-based method for stock returns prediction: A case study of china stock market. In Big Data (Big Data), 2015 IEEE International Conference on (pp. 2823–2824). IEEE.   
Chollet, F. et al. (2015). Keras. https://keras.io.   
Chong, E., Han, C., & Park, F. C. (2017). Deep learning networks for stock market analysis and prediction: Methodology, data representations, and case studies. Expert Systems with Applications, 83 , 187–205.   
Di Persio, L., & Honchar, O. (2016). Artificial neural networks architectures for stock price prediction: Comparisons and applications. International Journal of Circuits, Systems and Signal Processing, 10 , 403–413.   
Fama, E. F. (1970). Efficient capital markets: A review of theory and empirical work. The journal of Finance, 25 , 383–417.   
Fischer, T., & Krauss, C. (2018). Deep learning with long short-term memory networks for financial market predictions. European Journal of Operational Research, 270 , 654–669.

Gardner, M. W., & Dorling, S. (1998). Artificial neural networks (the multilayer perceptron)a review of applications in the atmospheric sciences. Atmospheric environment, 32 , 2627–2636.

Gunduz, H., Yaslan, Y., & Cataltepe, Z. (2017). Intraday prediction of borsa istanbul using convolutional neural networks and feature correlations. Knowledge-Based Systems, 137 , 138–148.

Guresen, E., Kayakutlu, G., & Daim, T. U. (2011). Using artificial neural network models in stock market index prediction. Expert Systems with Applications, 38 , 10389–10397.

Hagan, M. T., & Menhaj, M. B. (1994). Training feedforward networks with the marquardt algorithm. IEEE transactions on Neural Networks, 5 , 989–993.

He, K., Zhang, X., Ren, S., & Sun, J. (2016). Deep residual learning for image recognition. In Proceedings of the IEEE conference on computer vision and pattern recognition (pp. 770–778).

Hecht-Nielsen, R. (1992). Theory of the backpropagation neural network. In Neural networks for perception (pp. 65–93). Elsevier.

Hinton, G. E., Srivastava, N., Krizhevsky, A., Sutskever, I., & Salakhutdinov, R. R. (2012). Improving neural networks by preventing co-adaptation of feature detectors. arXiv preprint arXiv:1207.0580 , .

Hu, Y., Feng, B., Zhang, X., Ngai, E., & Liu, M. (2015a). Stock trading rule discovery with an evolutionary trend following model. Expert Systems with Applications, 42 , 212–222.

Hu, Y., Liu, K., Zhang, X., Su, L., Ngai, E., & Liu, M. (2015b). Application of evolutionary computation for rule discovery in stock algorithmic trading: A literature review. Applied Soft Computing, 36 , 534–551.

Kara, Y., Boyacioglu, M. A., & Baykan, O. K. (2011). Predicting direction of stock ¨ price index movement using artificial neural networks and support vector machines: The sample of the istanbul stock exchange. Expert systems with Applications, ${ \it 3 8 }$ , 5311–5319.

Khaidem, L., Saha, S., & Dey, S. R. (2016). Predicting the direction of stock market prices using random forest. arXiv preprint arXiv:1605.00003 , .   
Kim, K.-j. (2003). Financial time series forecasting using support vector machines. Neurocomputing, 55 , 307–319.   
Kim, K.-j., & Han, I. (2000). Genetic algorithms approach to feature discretization in artificial neural networks for the prediction of stock price index. Expert systems with Applications, 19 , 125–132.   
Krollner, B., Vanstone, B., & Finnie, G. (2010). Financial time series forecasting with machine learning techniques: A survey, .   
LeCun, Y., Bengio, Y., & Hinton, G. (2015). Deep learning. nature, 521 , 436.   
LeCun, Y., Bengio, Y. et al. (1995). Convolutional networks for images, speech, and time series. The handbook of brain theory and neural networks, 3361 , 1995.   
Lee, S., Enke, D., & Kim, Y. (2017). A relative value trading system based on a correlation and rough set analysis for the foreign exchange futures market. Engineering Applications of Artificial Intelligence, 61 , 47–56.   
Moghaddam, A. H., Moghaddam, M. H., & Esfandyari, M. (2016). Stock market index prediction using artificial neural network. Journal of Economics, Finance and Administrative Science, 21 , 89–93.   
Nassirtoussi, A. K., Aghabozorgi, S., Wah, T. Y., & Ngo, D. C. L. (2015). Text mining of news-headlines for forex market prediction: A multi-layer dimension reduction algorithm with semantics and sentiment. Expert Systems with Applications, 42 , 306–324.   
Nelson, D. M., Pereira, A. C., & de Oliveira, R. A. (2017). Stock market’s price movement prediction with lstm neural networks. In Neural Networks (IJCNN), 2017 International Joint Conference on (pp. 1419–1426). IEEE.   
Nison, S. (1994). Beyond candlesticks: New Japanese charting techniques revealed volume 56. John Wiley & Sons.   
Ou, P., & Wang, H. (2009). Prediction of stock market index movement by ten data mining techniques. Modern Applied Science, 3 , 28.

Ozg¨ur, A., ¨ Ozg¨ur, L., & G¨ung¨or, T. (2005). Text categorization with class-based ¨ and corpus-based keyword selection. In International Symposium on Computer and Information Sciences (pp. 606–615). Springer.

Patel, J., Shah, S., Thakkar, P., & Kotecha, K. (2015). Predicting stock and stock price index movement using trend deterministic data preparation and machine learning techniques. Expert Systems with Applications, 42 , 259–268.

Qiu, M., & Song, Y. (2016). Predicting the direction of stock market index movement using an optimized artificial neural network model. PloS one, 11 , e0155133.

Qiu, M., Song, Y., & Akagi, F. (2016). Application of artificial neural network for the prediction of stock market returns: The case of the japanese stock market. Chaos, Solitons & Fractals, 85 , 1–7.

Shah, D., & Zhang, K. (2014). Bayesian regression and bitcoin. In Communication, Control, and Computing (Allerton), 2014 52nd Annual Allerton Conference on (pp. 409–414). IEEE.

Srivastava, N., Hinton, G., Krizhevsky, A., Sutskever, I., & Salakhutdinov, R. (2014). Dropout: A simple way to prevent neural networks from overfitting. The Journal of Machine Learning Research, 15 , 1929–1958.

Wang, J., & Wang, J. (2015). Forecasting stock market indexes using principle component analysis and stochastic time effective neural networks. Neurocomputing, 156 , 68–78.

Yong, B. X., Rahim, M. R. A., & Abdullah, A. S. (2017). A stock market trading system using deep neural network. In Asian Simulation Conference (pp. 356–364). Springer.

Zhang, Y., & Wu, L. (2009). Stock market prediction of s&p 500 via combination of improved bco approach and bp neural network. Expert systems with applications, 36 , 8849–8854.

Zhao, Y., Li, J., & Yu, L. (2017). A deep learning ensemble approach for crude oil price forecasting. Energy Economics, 66 , 9–16.

Zhong, X., & Enke, D. (2017). Forecasting daily stock market return using dimensionality reduction. Expert Systems with Applications, 67 , 126–139.

Zhu, C., Yin, J., & Li, Q. (2014). A stock decision support system based on dbns. Journal of Computational Information Systems, 10 , 883–893.